---
title: Планирование развертывания Advanced Threat Analytics | Документация Майкрософт
description: В этой статье содержатся сведения, которые помогут запланировать развертывание и определить, сколько серверов ATA потребуется для поддержки сети
keywords: ''
author: shsagir
ms.author: shsagir
manager: rkarlin
ms.date: 10/16/2019
ms.topic: conceptual
ms.prod: advanced-threat-analytics
ms.assetid: 1b5b24ff-0df8-4660-b4f8-64d68cc72f65
ms.reviewer: bennyl
ms.suite: ems
ms.openlocfilehash: 0ec953c4311c12a44686cbbf4f4394492f74dd7f
ms.sourcegitcommit: 05f23a0add8d24ae92176e13c2a4ae8ada1844da
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79319157"
---
# <a name="ata-capacity-planning"></a>Планирование производительности ATA

*Применяется к: Advanced Threat Analytics версии 1.9*

В этой статье содержится информация, которая поможет определить, сколько серверов ATA потребуется для мониторинга сети. Он помогает оценить, сколько шлюзов ATA и/или упрощенных шлюзов ATA, а также емкость сервера для центра ATA и шлюзов ATA.

> [!NOTE] 
> Центр ATA можно развернуть в любом поставщике IaaS, если выполнены требования к производительности, описанные в этой статье.

## <a name="using-the-sizing-tool"></a>Использование средства изменения размера
Рекомендуемый и самый простой способ определить емкость развертывания ATA — это использовать [средство изменения размера ATA](https://aka.ms/atasizingtool). Запустите средство изменения размера ATA и в файле Excel с результатами определите необходимую емкость с помощью следующих полей:

- ЦП и память центра ATA: сопоставьте поле **Busy Packets/sec** (Занятых пакетов/с) в таблице центра ATA в файле результатов с полем **PACKETS PER SECOND** (Пакетов в секунду) в [таблице центра ATA](#ata-center-sizing).

- Хранилище центра ATA: сопоставьте поле **Avg Packets/sec** (Среднее число пакетов/с) в таблице центра ATA в файле результатов с полем **PACKETS PER SECOND** (ПАКЕТОВ В СЕКУНДУ) в [таблице центра ATA](#ata-center-sizing).
- Шлюз ATA: сопоставьте поле **Busy Packets/sec** (Занятых пакетов/с) в таблице шлюзов ATA в файле результатов с полем **PACKETS PER SECOND** (ПАКЕТОВ В СЕКУНДУ) в [таблице шлюзов ATA](#ata-gateway-sizing) или [таблице легковесных шлюзов ATA](#ata-lightweight-gateway-sizing), в зависимости от [выбранного типа шлюза](#choosing-the-right-gateway-type-for-your-deployment).


![Пример средства планирования емкости](media/capacity-tool.png)


> [!NOTE]
> Из-за различия разных сред и множества особых и непредвиденных особенностей сетевого трафика после первого развертывания ATA и запуска средства изменения размера может потребоваться изменить и настроить емкость развертывания.


Если по каким-либо причинам вы не можете использовать средство изменения размера ATA, необходимо вручную собрать данные по числу пакетов в секунду с коротким интервалом сбора (примерно 5 секунд) со всех контроллеров домена за 24 часа. Затем для каждого контроллера домена Вычислите среднее время ежедневности и период максимальной продолжительности (15 минут).
В следующих разделах приведены инструкции по получению счетчика пакетов/сек с одного контроллера домена.


> [!NOTE]
> Из-за различия разных сред и множества особых и непредвиденных особенностей сетевого трафика после первого развертывания ATA и запуска средства изменения размера может потребоваться изменить и настроить емкость развертывания.


### <a name="ata-center-sizing"></a>Определение размера и количества ресурсов для центра ATA
Чтобы проанализировать поведение пользователя, центру ATA требуются данные минимум за 30 дней.
 

|Пакетов в секунду от всех контроллеров домена|ЦП (ядра*)|Память (ГБ)|Объем хранилища базы данных в день (ГБ)|Объем хранилища базы данных в месяц (ГБ)|Операций ввода-вывода**|
|---------------------------|-------------------------|-------------------|---------------------------------|-----------------------------------|-----------------------------------|
|1000|2|32|0,3|9|30 (100)
|40 000|4|48|12|360|500 (750)
|200 000|8|64|60|1800|1000 (1500)
|400 000|12|96|120|3600|2000 (2500)
|750 000|24|112|225|6750|2500 (3000)
|1 000 000|40|128|300|9000|4000 (5000)

* Сюда относятся физические ядра, а не ядра с поддержкой технологии Hyper-Threading.

** Средние значения (пиковые значения).
> [!NOTE]
> - Центр ATA может обрабатывать совокупное максимальное количество пакетов в 1 секунду от всех наблюдаемых контроллеров домена. В некоторых средах один и тот же центр ATA может работать с общим трафиком, превышающим 1 МБ, а некоторые среды могут превышать емкость ATA. Свяжитесь с нами по адресу azureatpfeedback@microsoft.com, чтобы получить помощь в планировании и оценке крупных сред.

> - Если на диске остается менее 20 % или 200 ГБ свободного места, самая старая коллекция данных удаляется. Если сбор данных невозможно сократить до этого уровня, будет зарегистрировано предупреждение.  ATA продолжит функционировать до достижения порогового значения, составляющего 5 % или 50 ГБ свободного места.  На этом этапе ATA прекратит заполнение базы данных, и будет выведено дополнительное предупреждение.
> - Вы можете развернуть Центр ATA в любом поставщике IaaS, если выполнены требования к производительности, описанные в этой статье.
> - При выполнении действий чтения и записи задержка хранилища должна быть менее 10 мс.
> - Соотношение между количеством операций чтения и записи должно составлять примерно 1:3 при обработке меньше 100 000 пакетов в секунду и 1:6 при обработке свыше 100 000 пакетов в секунду.
> - При запуске центра в качестве виртуальной машины центру требуется, чтобы вся память была выделена для ВИРТУАЛЬНОЙ машины. Дополнительные сведения о запуске центра ATA в качестве виртуальной машины см. в статье [требования к центру ATA](https://docs.microsoft.com/advanced-threat-analytics/ata-prerequisites#dynamic-memory) .
> - Для обеспечения оптимальной производительности задайте для **параметра электропитания** центра ATA значение **высокой производительности**.<br>
> - При работе с физическим сервером для базы данных ATA необходимо **отключить** доступ к неоднородной памяти (NUMA) в BIOS. Система может ссылаться на NUMA как на чередование узлов. В таком случае необходимо **включить** чередование узлов, чтобы отключить NUMA. Дополнительные сведения см. в документации по BIOS. Это не имеет значения, если центр ATA выполняется на виртуальном сервере.


## <a name="choosing-the-right-gateway-type-for-your-deployment"></a>Выбор правильного типа шлюза для развертывания
В развертывании ATA поддерживается любое сочетание типов шлюза ATA:

- только шлюзы ATA;
- только упрощенные шлюзы ATA.
- Комбинация шлюзов

При выборе типа развертывания шлюза необходимо учитывать указанные ниже преимущества.

|Тип шлюза|Преимущества|Стоимость|Топология развертывания|Использование контроллера домена|
|----|----|----|----|-----|
|Шлюз ATA|Внешнее развертывание усложняет обнаружение ATA для злоумышленников|Выше|Устанавливается вместе с контроллером домена (внешняя установка)|Поддерживает до 50 000 пакетов в секунду|
|Упрощенный шлюз ATA|Не требует выделенного сервера и настройки зеркального отражения портов|Нижний|Устанавливается на контроллере домена|Поддерживает до 10 000 пакетов в секунду|

Ниже приведены примеры сценариев, в которых работу всех контроллеров домена контролирует упрощенный шлюз ATA:


- сайты филиалов;

- Виртуальные контроллеры доменов, развернутые в облаке (IaaS)


Ниже приведены примеры сценариев, в которых работу всех контроллеров домена контролирует шлюз ATA:


- Главные центры обработки данных (имеющие контроллеры доменов со скоростью передачи более 10 000 пакетов в секунду)


### <a name="ata-lightweight-gateway-sizing"></a>Размеры упрощенных шлюзов ATA

Упрощенный шлюз ATA поддерживает отслеживание одного контроллера домена в зависимости от объема сетевого трафика, создаваемого контроллером домена. 


|Пакетов в секунду&#42;|Число ядер ЦП&#42;&#42;|Память (ГБ)&#42;&#42;&#42;|
|---------------------------|-------------------------|---------------|
|1000|2|6|
|5000|6|16|
    |10 000|10|24|

&#42; Общее количество пакетов в секунду в контроллере домена, который отслеживает конкретный упрощенный шлюз ATA.

&#42;&#42;Общее количество ядер без применения технологии Hyper-Threading, установленных на этом контроллере домена.<br>Хотя технология Hyper-Threading является приемлемой для упрощенного шлюза ATA, при планировании производительности необходимо подсчитать фактические ядра и ядра без применения технологии Hyper-Threading.

&#42;&#42;&#42;Общий объем памяти, установленной в этом контроллере домена.

> [!NOTE]   
> -   Если на контроллере домена нет ресурсов, необходимых для упрощенного шлюза ATA, это не повлияет на производительность контроллера домена, но упрощенный шлюз ATA, возможно, не будет работать должным образом.
> -   При запуске центра в качестве виртуальной машины центру требуется, чтобы вся память была выделена для ВИРТУАЛЬНОЙ машины. Дополнительные сведения о запуске центра ATA в качестве виртуальной машины см. в статье [требования к центру ATA](https://docs.microsoft.com/advanced-threat-analytics/ata-prerequisites#dynamic-memory).
> -   Для обеспечения оптимальной производительности задайте для **параметра электропитания** упрощенного шлюза ATA значение **высокой производительности**.
> -   Требуется не менее 5 ГБ пространства. Мы рекомендуем 10 ГБ. Сюда входит пространство, необходимое для двоичных файлов ATA, [журналов ATA](troubleshooting-ata-using-logs.md) и [журналов производительности](troubleshooting-ata-using-perf-counters.md).


### <a name="ata-gateway-sizing"></a>Определение размера шлюза ATA

При определении числа шлюзов ATA, которые необходимо развернуть, учитывайте указанные ниже моменты.

-   **Леса и домены Active Directory**<br>
    ATA может отслеживать трафик из нескольких доменов в рамках одного леса Active Directory. Чтобы выполнять мониторинг нескольких лесов Active Directory, требуются отдельные развертывания ATA. Не настраивайте одно развертывание ATA для отслеживания сетевого трафика контроллеров домена в разных лесах.

-   **Зеркальное отображение портов**<br>
Согласно рекомендациям по зеркальному отображению портов, возможно, потребуется развернуть несколько шлюзов ATA в центре данных или на сайте филиала.

-   **Емкость**<br>
    Шлюз ATA поддерживает отслеживание нескольких контроллеров домена в зависимости от объема сетевого трафика отслеживаемых контроллеров домена. 
<br>



|Пакетов в секунду&#42;|Число ядер ЦП&#42;&#42;|Память (ГБ)|
|---------------------------|-------------------------|---------------|
|1000|1|6|
|5000|2|10|
|10 000|3|12|
|20 000|6|24|
|50 000|16|48|

&#42; Среднее количество пакетов в секунду, отправляемых всеми контроллерами домена, которые отслеживает конкретный шлюз ATA в час наибольшей нагрузки.

&#42; Общий объем зеркально отображенного трафика контроллера домена не может превышать емкость сетевого адаптера в шлюзе ATA.

&#42;&#42; Технология Hyper-Threading должна быть отключена.

> [!NOTE] 
> -   При запуске центра в качестве виртуальной машины центру требуется, чтобы вся память была выделена для ВИРТУАЛЬНОЙ машины. Дополнительные сведения о запуске центра ATA в качестве виртуальной машины см. в статье [требования к центру ATA](https://docs.microsoft.com/advanced-threat-analytics/ata-prerequisites#dynamic-memory) .
> -   Для обеспечения оптимальной производительности установите **Параметр электропитания** шлюза ATA на **Высокую производительность**.
> -   Требуется не менее 5 ГБ пространства. Мы рекомендуем 10 ГБ. Сюда входит пространство, необходимое для двоичных файлов ATA, [журналов ATA](troubleshooting-ata-using-logs.md) и [журналов производительности](troubleshooting-ata-using-perf-counters.md).



## <a name="related-videos"></a>Связанные видео
- [Выбор правильного типа шлюза ATA](https://channel9.msdn.com/Shows/Microsoft-Security/ATA-Deployment-Choose-the-Right-Gateway-Type)


## <a name="see-also"></a>См. также
- [Средство изменения размера ATA](https://aka.ms/atasizingtool)
- [Предварительные требования ATA](ata-prerequisites.md)
- [Архитектура ATA](ata-architecture.md)
- [Ознакомьтесь с форумом ATA.](https://social.technet.microsoft.com/Forums/security/home?forum=mata)
