---
title: "Устранение неполадок в Advanced Threat Analytics с использованием счетчиков производительности | Документация Майкрософт"
description: "Описывает порядок использования счетчиков производительности для устранения неполадок с ATA"
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 01/23/2017
ms.topic: article
ms.prod: 
ms.service: advanced-threat-analytics
ms.technology: 
ms.assetid: df162a62-f273-4465-9887-94271f5000d2
ms.reviewer: bennyl
ms.suite: ems
ms.openlocfilehash: 929885891e2fc490e3ff358559e4995c545466b3
ms.sourcegitcommit: 49e892a82275efa5146998764e850959f20d3216
translationtype: HT
---
*Область применения: Advanced Threat Analytics версии 1.7*



# <a name="troubleshooting-ata-using-the-performance-counters"></a>Устранение неполадок в ATA с помощью счетчиков производительности
Счетчики производительности ATA дают возможность понять, как работает каждый компонент ATA. Компоненты в ATA обрабатывают данные последовательно. Таким образом, при появлении проблемы в цепочке компонентов может возникать частичная потеря трафика. Чтобы устранить эту проблему, необходимо выяснить, какой компонент вышел из строя, и устранить проблему в начале цепочки. Используйте данные счетчиков производительности, чтобы понять принцип работы каждого компонента.
См. сведения о потоке внутренних компонентов ATA в статье [Архитектура ATA](/advanced-threat-analytics/plan-design/ata-architecture).

**Работа компонентов АТА**:

1.  Когда компонент достигает максимального размера, он блокирует прием объектов от предыдущего компонента.

2.  Cо временем предыдущий компонент начнет увеличивать **свой** собственный размер до тех пор, пока не блокирует прием сущностей от предыдущего компонента.

3.  Этот процесс повторится на всех компонентах вплоть до прослушивателя сети, который будет игнорировать входящий трафик, когда не может отправлять объекты.


## <a name="ata-gateway-performance-counters"></a>Счетчики производительности шлюза АТА

В этом разделе все справочные материалы о шлюзе ATA также относятся и к упрощенному шлюзу ATA.

Вы можете наблюдать за состоянием производительности шлюза АТА в реальном времени, добавив счетчики производительности шлюза АТА.
Для этого нужно открыть "Системный монитор" и добавить все счетчики для шлюза АТА. Имя счетчика производительности "Microsoft ATA Gateway".

Ниже приведен перечень основных счетчиков шлюза АТА, на которые следует обратить внимание:

|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|Microsoft ATA Gateway\NetworkListener PEF Parsed Messages\Sec|Количество трафика, обрабатываемого шлюзом АТА ежесекундно.|Нет порогового значения|Позволяет вам понять, какое количество трафика используется шлюзом АТА.|
|NetworkListener PEF Dropped Events\Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Gateway\NetworkListener ETW Dropped Events\Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Gateway\NetworkActivityTranslator Message Data # Block Size|Объем трафика в очереди на перевод сетевых операций.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 100 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Gateway\EntityResolver Activity Block Size|Количество сетевых операций, ожидающих разрешения.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Gateway\EntitySender Entity Batch Block Size|Количество сетевых операций, ожидающих отправки в Центр АТА.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 1 000 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Gateway\EntitySender Batch Send Time|Количество времени, которое потребовалось для отправки последнего пакета.|Большую часть времени должно быть менее 1000 миллисекунд|Убедитесь, что нет никаких сетевых проблем между шлюзом АТА и Центром АТА.|

> [!NOTE]
> -   Единица измерения счетчиков — миллисекунды.
> -   Иногда удобнее отслеживать весь перечень счетчиков с помощью диаграммы "Отчет" (пример: наблюдение в реальном времени за всеми счетчиками)

## <a name="ata-lightweight-gateway-performance-counters"></a>Счетчики производительности упрощенного шлюза АТА
Эти счетчики производительности можно использовать для управления квотами в упрощенном шлюзе, чтобы система ATA не отбирала слишком много ресурсов контроллеров домена, на которых она установлена.
Чтобы определить налагаемые ATA ограничения в отношении ресурсов для упрощенного шлюза, добавьте следующие счетчики.

Для этого нужно в системном мониторе добавьте все счетчики для облегченного шлюза АТА. Объектам счетчиков производительности присвоены имена "Microsoft ATA Gateway" (Шлюз Microsoft ATA) и "Microsoft ATA Gateway Updater" (Средство обновления шлюза Microsoft ATA).


|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|Microsoft ATA Gateway Updater\GatewayUpdaterResourceManager CPU Time Max %|Максимальный объем времени ЦП (в процентах), который может использовать процесс упрощенного шлюза. |Нет порогового значения. | Это ограничение защищает ресурсы контроллера домена от чрезмерного использования упрощенным шлюзом ATA. Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует добавить дополнительные ресурсы для сервера, на котором работает контроллер домена.|
|Microsoft ATA Gateway Updater\GatewayUpdaterResourceManager Commit Memory Max Size|Максимальный объем выделенной памяти (в байтах), который может использовать процесс упрощенного шлюза.|Нет порогового значения. | Это ограничение защищает ресурсы контроллера домена от чрезмерного использования упрощенным шлюзом ATA. Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует добавить дополнительные ресурсы для сервера, на котором работает контроллер домена.| 
|Microsoft ATA Gateway Updater\GatewayUpdaterResourceManager Working Set Limit Size|Максимальный объем физической памяти (в байтах), который может использовать процесс упрощенного шлюза.|Нет порогового значения. | Это ограничение защищает ресурсы контроллера домена от чрезмерного использования упрощенным шлюзом ATA. Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует добавить дополнительные ресурсы для сервера, на котором работает контроллер домена.|



Следующие счетчики позволяют просмотреть фактическое потребление ресурсов.



|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|Process(Microsoft.tri.Gateway)\%Загруженность процессора|Объем времени ЦП (в процентах), который использует процесс упрощенного шлюза. |Нет порогового значения. | Сравните показания этого счетчика с ограничением, установленным в параметре "GatewayUpdaterResourceManager CPU Time Max %". Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует выделить дополнительные ресурсы для упрощенного шлюза.|
|Process(Microsoft.Tri.Gateway)\Private Bytes|Объем выделенной памяти (в байтах), который использует процесс упрощенного шлюза.|Нет порогового значения. | Сравните показания этого счетчика с лимитом, установленным в параметре "GatewayUpdaterResourceManager Commit Memory Max Size". Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует выделить дополнительные ресурсы для упрощенного шлюза.| 
|Process(Microsoft.Tri.Gateway)\Working Set|Объем физической памяти (в байтах), который использует процесс упрощенного шлюза.|Нет порогового значения. |Сравните показания этого счетчика с лимитом, установленным в параметре "GatewayUpdaterResourceManager Working Set Limit Size". Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует выделить дополнительные ресурсы для упрощенного шлюза.|

## <a name="ata-center-performance-counters"></a>Счетчики производительности Центра АТА
Вы можете наблюдать за состоянием производительности Центра АТА в реальном времени, добавив счетчики производительности Центра АТА.

Для этого нужно открыть "Системный монитор" и добавить все счетчики для Центра АТА. Имя счетчика производительности "Microsoft ATA Center".

Ниже приведен перечень основных счетчиков Центра АТА, на которые следует обратить внимание:

|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|Microsoft ATA Center\EntityReceiver Entity Batch Block Size|Количество пакетов объектов в очереди к Центру АТА.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети.  См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Center\NetworkActivityProcessor Network Activity Block Size|Количество сетевых операций, ожидающих обработки.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 50 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Center\EntityProfiler Network Activity Block Size|Количество сетевых операций, ожидающих профилирования.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|Microsoft ATA Center\Database &#42; Block Size|Количество сетевых операций особого вида, ожидающих записи в базу данных.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 50 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|


> [!NOTE]
> -   Единица измерения счетчиков — миллисекунды.
> -   Иногда удобнее отслеживать весь перечень счетчиков с помощью диаграммы "Отчет" (пример: наблюдение в реальном времени за всеми счетчиками).

## <a name="operating-system-counters"></a>Счетчики операционной системы
Ниже приведен перечень основных счетчиков операционной системы, на которые следует обратить внимание.

|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|Процессор(_Всего)\% загруженности процессора|Процент прошедшего времени, которое процессор тратит на выполнение непростаивающего потока.|В среднем менее 80%|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Процессор(_Всего)\% загруженности процессора" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "Система\Длина очереди процессора".|
|System\Context Switches\sec|Частота, с которой все процессоры переключаются с одного потока на другой.|Менее чем 5000&#42;ядер (физических ядер)|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Процессор(_Всего)\% загруженности процессора" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "Система\Длина очереди процессора".|
|Система\Длина очереди процессора|Количество потоков, готовых к выполнению и ожидающих назначения.|Менее чем 5&#42;ядер (физических ядер)|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Процессор(_Всего)\% загруженности процессора" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "Система\Длина очереди процессора".|
|\Память\Доступно МБ|Объем физической памяти (ОЗУ), доступной для выделения.|Должно быть более 512|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше физической памяти, чем должно быть.<br /><br />Увеличьте объем физической памяти.<br /><br />Сократите количество трафика на сервере.|
|LogicalDisk(&#42;)\Avg. Disk sec\Read|Средняя задержка чтения данных с диска (к примеру, вы должны выбрать диск с данными)|Должно занимать не более 10 миллисекунд|Проверьте, есть ли специфические процессы, которые занимают на диске с данными больше места, чем следует.<br /><br />Обратитесь к поставщику, чтобы узнать, может ли этот диск выполнять текущий объем работы, имея менее 10 миллисекунд на время ожидания. Текущий объем работы может быть определен с помощью счетчиков использования производительности.|
|LogicalDisk(&#42;)\Avg. Disk sec\Write|Средняя задержка записи данных на диск (к примеру, вы должны выбрать диск с данными).|Должно занимать не более 10 миллисекунд|Проверьте, есть ли специфические процессы, которые занимают на диске с данными больше места, чем следует.<br /><br />Обратитесь к поставщику, чтобы узнать, может ли этот диск выполнять текущий объем работы при задержке менее 10 мс. Текущий объем работы может быть определен с помощью счетчиков использования производительности.|
|\LogicalDisk(&#42;)\Disk Reads\sec|Уровень выполнения операций чтения на диске.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|
|\LogicalDisk(&#42;)\Disk Read Bytes\sec|Количество байт, считанных с диска за секунду.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|
|\LogicalDisk&#42;\Disk Writes\sec|Уровень выполнения операций записи на диск.|Нет порогового значения|Счетчики использования производительности (могут помочь при устранении неполадок с памятью).|
|\LogicalDisk(&#42;)\Disk Write Bytes\sec|Количество байт, записанных на диск за секунду.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|

## <a name="see-also"></a>См. также
- [Предварительные требования ATA](/advanced-threat-analytics/plan-design/ata-prerequisites)
- [Планирование производительности ATA](/advanced-threat-analytics/plan-design/ata-capacity-planning)
- [Настройка сбора данных о событиях](/advanced-threat-analytics/deploy-use/configure-event-collection)
- [Настройка пересылки событий Windows](/advanced-threat-analytics/deploy-use/configure-event-collection#configuring-windows-event-forwarding)
- [Ознакомьтесь с форумом ATA.](https://social.technet.microsoft.com/Forums/security/home?forum=mata)
