---
# required metadata

title: Устранение неполадок в ATA с помощью счетчиков производительности | Средство анализа угроз повышенной сложности Microsoft Advanced Threat Analytics
description: Описывает порядок использования счетчиков производительности для устранения неполадок с ATA
keywords:
author: rkarlin
manager: stevenpo
ms.date: 04/28/2016
ms.topic: article
ms.prod: identity-ata
ms.service: advanced-threat-analytics
ms.technology: security
ms.assetid: df162a62-f273-4465-9887-94271f5000d2

# optional metadata

#ROBOTS:
#audience:
#ms.devlang:
ms.reviewer: bennyl
ms.suite: ems
#ms.tgt_pltfrm:
#ms.custom:

---

# Устранение неполадок в ATA с помощью счетчиков производительности
Счетчики производительности ATA дают возможность понять, как работает каждый компонент ATA.

**Работа компонентов АТА**:

1.  Когда компонент достигает максимального размера, он блокирует прием объектов от предыдущего компонента.

2.  Cо временем предыдущий компонент начнет увеличивать **свой** собственный размер до тех пор, пока не блокирует прием сущностей от предыдущего компонента.

3.  Этот процесс происходит до тех пор, пока очередь не дойдет до начального компонента прослушивателя сети, который прекратит трафик, когда не сможет больше отправлять объекты.

    Это значит, что для исправления реакции цепи, которая вызывает сброс трафика, вам нужно исправить проблему в конце цепи.
    Чтобы понять концепцию потока внутренних компонентов АТА, ознакомьтесь с [архитектурой АТА](/advanced-threat-analytics/Understand/ata-architecture).

## Счетчики производительности шлюза АТА
Вы можете наблюдать за состоянием производительности шлюза АТА в реальном времени, добавив счетчики производительности шлюза АТА.
Для этого нужно открыть "Системный монитор" и добавить все счетчики для шлюза АТА. Имя счетчика производительности "Microsoft ATA Gateway".

![Изображение окна добавления счетчиков производительности](media/ATA-performance-counters.png)

Ниже приведен перечень основных счетчиков шлюза АТА, на которые следует обратить внимание:

|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|NetworkListener Captured Parser Messages/Sec|Количество трафика, обрабатываемого шлюзом АТА ежесекундно.|Нет порогового значения|Позволяет вам понять, какое количество трафика используется шлюзом АТА.|
|NetworkListener Captured Dropped Messages/Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|NetworkListener Captured Dropped ETW Real Time Buffers/Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|NetworkListener Captured Dropped ETW Log Buffers/Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|NetworkListener Captured Dropped ETW Events/Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|NetworkActivityTranslator Message Data # Block Size|Объем трафика в очереди на перевод сетевых операций.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 100 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|EntityResolver Activity Block Size|Количество сетевых операций, ожидающих разрешения.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|EntitySender Entity Batch Block Size|Количество сетевых операций, ожидающих отправки в Центр АТА.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 1 000 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|EntitySender Batch Send Time|Количество времени, которое потребовалось для отправки последнего пакета.|Большую часть времени должно быть менее 1000 миллисекунд|Убедитесь, что нет никаких сетевых проблем между шлюзом АТА и Центром АТА.|

> [!NOTE]
> -   Единица измерения счетчиков — миллисекунды.
> -   Иногда удобнее отслеживать весь перечень счетчиков с помощью диаграммы "Отчет" (пример: наблюдение в реальном времени за всеми счетчиками)

## Счетчики производительности Центра АТА
Вы можете наблюдать за состоянием производительности Центра АТА в реальном времени, добавив счетчики производительности Центра АТА.

Для этого нужно открыть "Системный монитор" и добавить все счетчики для Центра АТА. Имя счетчика производительности "Microsoft ATA Center".

![Добавить счетчики производительности Центра АТА](media/ATA-Gateway-perf-counters.png)

Ниже приведен перечень основных счетчиков Центра АТА, на которые следует обратить внимание:

|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|EntityReceiver Entity Batch Block Size|Количество пакетов объектов в очереди к Центру АТА.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 100)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети.  См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|NetworkActivityProcessor Network Activity Block Size|Количество сетевых операций, ожидающих обработки.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|EntityProfiler Network Activity Block Size|Количество сетевых операций, ожидающих профилирования.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|CenterDatabaseClient &#42; Block Size|Количество сетевых операций особого вида, ожидающих записи в базу данных.|Должно быть меньше максимального -1 (по умолчанию максимальное значение: 50 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
|DetectionEngine Detection Time|Общее количество времени, потраченное на последний полный цикл детерминированных обнаружений.|Должно быть менее 900 000 (15 минут)|Убедитесь, что нет проблем с центральным процессором, памятью или хранилищем.|

> [!NOTE]
> -   Единица измерения счетчиков — миллисекунды.
> -   Иногда удобнее отслеживать весь перечень счетчиков с помощью диаграммы "Отчет" (пример: наблюдение в реальном времени за всеми счетчиками).

Ниже приведен перечень основных счетчиков операционной системы, на которые следует обратить внимание:

|Счетчик|Описание|Threshold|Диагностика|
|-----------|---------------|-------------|-------------------|
|Processor(_Total)\% Processor Time|Процент прошедшего времени, которое процессор тратит на выполнение непростаивающего потока.|В среднем менее 80%|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Processor(_Total)\% Processor Time" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "System\Processor Queue Length".|
|System\Context Switches/sec|Частота, с которой все процессоры переключаются с одного потока на другой.|Менее чем 5000&#42;ядер (физических ядер)|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Processor(_Total)\% Processor Time" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "System\Processor Queue Length".|
|Система\Длина очереди процессора|Количество потоков, готовых к выполнению и ожидающих назначения.|Менее чем 5&#42;ядер (физических ядер)|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Processor(_Total)\% Processor Time" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "System\Processor Queue Length".|
|\Память\Доступно МБ|Объем физической памяти (ОЗУ), доступной для выделения.|Должно быть более 512|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше физической памяти, чем должно быть.<br /><br />Увеличьте объем физической памяти.<br /><br />Сократите количество трафика на сервере.|
|LogicalDisk(&#42;)\Avg. время чтения с диска (сек)"|Средняя задержка чтения данных с диска (к примеру, вы должны выбрать диск с данными)|Должно занимать не более 10 миллисекунд|Проверьте, есть ли специфические процессы, которые занимают на диске с данными больше места, чем следует.<br /><br />Обратитесь к поставщику, чтобы узнать, может ли этот диск выполнять текущий объем работы, имея менее 10 миллисекунд на время ожидания. Текущий объем работы может быть определен с помощью счетчиков использования производительности.|
|LogicalDisk(&#42;)\Avg. время записи на диск (сек)|Средняя задержка записи данных на диск (к примеру, вы должны выбрать диск с данными).|Должно занимать не более 10 миллисекунд|Проверьте, есть ли специфические процессы, которые занимают на диске с данными больше места, чем следует.<br /><br />Обратитесь к поставщику, чтобы узнать, может ли этот диск выполнять текущий объем работы, имея менее 10 миллисекунд на время ожидания. Текущий объем работы может быть определен с помощью счетчиков использования производительности.|
|\LogicalDisk(&#42;)\Disk Reads/sec|Уровень выполнения операций чтения на диске.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|
|\LogicalDisk(&#42;)\Disk Read Bytes/sec|Количество байт, считанных с диска за секунду.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|
|\LogicalDisk(&#42;)\Disk Writes/sec|Уровень выполнения операций записи на диск.|Нет порогового значения|Счетчики использования производительности (могут помочь при устранении неполадок с памятью).|
|\LogicalDisk(&#42;)\Disk Write Bytes/sec|Количество байт, записанных на диск за секунду.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|


<!--HONumber=Apr16_HO2-->


