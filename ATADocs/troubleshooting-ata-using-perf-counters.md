---
title: Устранение неполадок в Advanced Threat Analytics с использованием счетчиков производительности | Документация Майкрософт
description: Описывает порядок использования счетчиков производительности для устранения неполадок с ATA
keywords: ''
author: mlottner
ms.author: mlottner
manager: barbkess
ms.date: 9/25/2018
ms.topic: conceptual
ms.prod: advanced-threat-analytics
ms.service: ''
ms.technology: ''
ms.assetid: df162a62-f273-4465-9887-94271f5000d2
ms.reviewer: bennyl
ms.suite: ems
ms.openlocfilehash: f5eac97c2c3da5294f5fa42b00792cafe456b35e
ms.sourcegitcommit: 78748bfd75ae68230d72ad11010ead37d96b0c58
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2019
ms.locfileid: "56078023"
---
# <a name="troubleshooting-ata-using-the-performance-counters"></a>Устранение неполадок в ATA с помощью счетчиков производительности

*Область применения: Advanced Threat Analytics версии 1.9*

Счетчики производительности ATA дают возможность понять, как работает каждый компонент ATA. Компоненты в ATA обрабатывают данные последовательно. Таким образом, при появлении проблемы в цепочке компонентов может возникать частичная потеря трафика. Чтобы устранить эту проблему, необходимо выяснить, какой компонент вышел из строя, и устранить проблему в начале цепочки. Используйте данные счетчиков производительности, чтобы понять принцип работы каждого компонента.
См. сведения о потоке внутренних компонентов ATA в статье [Архитектура ATA](ata-architecture.md).

**Работа компонентов АТА**:

1.  Когда компонент достигает максимального размера, он блокирует прием объектов от предыдущего компонента.

2.  Cо временем предыдущий компонент начнет увеличивать **свой** собственный размер до тех пор, пока не блокирует прием сущностей от предыдущего компонента.

3.  Этот процесс повторится на всех компонентах вплоть до прослушивателя сети, который будет игнорировать входящий трафик, если более не может отправлять объекты.


## <a name="retrieving-performance-monitor-files-for-troubleshooting"></a>Извлечение файлов монитора производительности для устранения неполадок

Извлечение файлов монитора производительности (BLG) из разных компонентов ATA
1.  Откройте системный монитор.
2.  Остановите набор сборщиков данных **Шлюз Microsoft ATA** или **Центр Microsoft ATA**.
3.  Перейдите в папку набора сборщиков данных (по умолчанию — "C:\Program Files\Microsoft Advanced Threat Analytics\Gateway\Logs\DataCollectorSets" или "C:\Program Files\Microsoft Advanced Threat Analytics\Center\Logs\DataCollectorSets").
4.  Скопируйте BLG-файл, который был изменен позже всех.
5.  Перезапустите набор сборщиков данных **Шлюз Microsoft ATA** или **Центр Microsoft ATA**.


## <a name="ata-gateway-performance-counters"></a>Счетчики производительности шлюза АТА

В этом разделе все справочные материалы о шлюзе ATA также относятся и к упрощенному шлюзу ATA.

Вы можете наблюдать за состоянием производительности шлюза АТА в реальном времени, добавив счетчики производительности шлюза АТА.
Для этого нужно открыть **системный монитор** и добавить все счетчики для шлюза АТА. Имя объекта счетчика производительности — **Шлюз Microsoft ATA**.

Ниже приведен перечень основных счетчиков шлюза АТА, на которые следует обратить внимание:

> [!div class="mx-tableFixed"]
> 
> |Счетчик|Описание|Threshold|Диагностика|
> |-----------|---------------|-------------|-------------------|
> |Microsoft ATA Gateway\NetworkListener PEF Parsed Messages\Sec|Количество трафика, обрабатываемого шлюзом АТА ежесекундно.|Нет порогового значения|Позволяет вам понять, какое количество трафика используется шлюзом АТА.|
> |NetworkListener PEF Dropped Events\Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Gateway\NetworkListener ETW Dropped Events\Sec|Количество трафика, сбрасываемого шлюзом АТА ежесекундно.|Здесь постоянно должен быть ноль (допустимы редкие короткие внезапные сбросы)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Gateway\NetworkActivityTranslator Message Data # Block Size|Объем трафика в очереди на перевод сетевых операций.|Должно быть меньше максимального значения -1 (по умолчанию максимальное значение: 100 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Gateway\EntityResolver Activity Block Size|Число сетевых операций, ожидающих разрешения.|Должно быть меньше максимального значения -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Gateway\EntitySender Entity Batch Block Size|Количество сетевых операций, ожидающих отправки в Центр АТА.|Должно быть меньше максимального значения -1 (по умолчанию максимальное значение: 1 000 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. См. раздел **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Gateway\EntitySender Batch Send Time|Количество времени, которое потребовалось для отправки последнего пакета.|Большую часть времени должно быть менее 1000 миллисекунд|Убедитесь, что нет никаких сетевых проблем между шлюзом АТА и Центром АТА.|
> 
> [!NOTE]
> -   Единица измерения счетчиков — миллисекунды.
> -   Иногда удобнее отслеживать весь перечень счетчиков с помощью диаграммы **Отчет** (пример: наблюдение в реальном времени за всеми счетчиками)

## <a name="ata-lightweight-gateway-performance-counters"></a>Счетчики производительности упрощенного шлюза АТА
Эти счетчики производительности можно использовать для управления квотами в упрощенном шлюзе, чтобы система ATA не отбирала слишком много ресурсов контроллеров домена, на которых она установлена.
Чтобы определить налагаемые ATA ограничения в отношении ресурсов для упрощенного шлюза, добавьте следующие счетчики.

Для этого нужно открыть **системный монитор** и добавить все счетчики для облегченного шлюза АТА. Имя счетчика производительности — **Шлюз Microsoft ATA** или **Средство обновления центра Microsoft ATA**.

> [!div class="mx-tableFixed"]
> 
> |Счетчик|Описание|Threshold|Диагностика|
> |-----------|---------------|-------------|-------------------|
> |Microsoft ATA Gateway Updater\GatewayUpdaterResourceManager CPU Time Max %|Максимальный объем времени ЦП (в процентах), который может использовать процесс упрощенного шлюза. |Нет порогового значения. | Это ограничение защищает ресурсы контроллера домена от чрезмерного использования упрощенным шлюзом ATA. Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует добавить дополнительные ресурсы для сервера, на котором работает контроллер домена.|
> |Microsoft ATA Gateway Updater\GatewayUpdaterResourceManager Commit Memory Max Size|Максимальный объем выделенной памяти (в байтах), который может использовать процесс упрощенного шлюза.|Нет порогового значения. | Это ограничение защищает ресурсы контроллера домена от чрезмерного использования упрощенным шлюзом ATA. Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует добавить дополнительные ресурсы для сервера, на котором работает контроллер домена.| 
> |Microsoft ATA Gateway Updater\GatewayUpdaterResourceManager Working Set Limit Size|Максимальный объем физической памяти (в байтах), который может использовать процесс упрощенного шлюза.|Нет порогового значения. | Это ограничение защищает ресурсы контроллера домена от чрезмерного использования упрощенным шлюзом ATA. Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует добавить дополнительные ресурсы для сервера, на котором работает контроллер домена.|



Следующие счетчики позволяют просмотреть фактическое потребление ресурсов.


> [!div class="mx-tableFixed"]
> 
> |Счетчик|Описание|Threshold|Диагностика|
> |-----------|---------------|-------------|-------------------|
> |Process(Microsoft.tri.Gateway)\%Загруженность процессора|Объем времени ЦП (в процентах), который использует процесс упрощенного шлюза. |Нет порогового значения. | Сравните показания этого счетчика с ограничением, установленным в параметре "GatewayUpdaterResourceManager CPU Time Max %". Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует выделить дополнительные ресурсы для упрощенного шлюза.|
> |Process(Microsoft.Tri.Gateway)\Private Bytes|Объем выделенной памяти (в байтах), который использует процесс упрощенного шлюза.|Нет порогового значения. | Сравните показания этого счетчика с лимитом, установленным в параметре "GatewayUpdaterResourceManager Commit Memory Max Size". Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует выделить дополнительные ресурсы для упрощенного шлюза.| 
> |Process(Microsoft.Tri.Gateway)\Working Set|Объем физической памяти (в байтах), который использует процесс упрощенного шлюза.|Нет порогового значения. |Сравните показания этого счетчика с лимитом, установленным в параметре "GatewayUpdaterResourceManager Working Set Limit Size". Если вы видите, что в течение некоторого времени процесс часто достигает максимального значения (и после этого игнорирует входящий трафик), вам следует выделить дополнительные ресурсы для упрощенного шлюза.|

## <a name="ata-center-performance-counters"></a>Счетчики производительности Центра АТА
Вы можете наблюдать за состоянием производительности Центра АТА в реальном времени, добавив счетчики производительности Центра АТА.

Для этого нужно открыть **системный монитор** и добавить все счетчики для Центра АТА. Имя объекта счетчика производительности — **Центр Microsoft ATA**.

Ниже приведен перечень основных счетчиков Центра АТА, на которые следует обратить внимание:

> [!div class="mx-tableFixed"]
> 
> |Счетчик|Описание|Threshold|Диагностика|
> |-----------|---------------|-------------|-------------------|
> |Microsoft ATA Center\EntityReceiver Entity Batch Block Size|Количество пакетов объектов в очереди к Центру АТА.|Должно быть меньше максимального значения -1 (по умолчанию максимальное значение: 10 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети.  Сведения см. в разделе **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Center\NetworkActivityProcessor Network Activity Block Size|Количество сетевых операций, ожидающих обработки.|Должно быть меньше максимального значения -1 (по умолчанию максимальное значение: 50 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. Сведения см. в разделе **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Center\EntityProfiler Network Activity Block Size|Количество сетевых операций, ожидающих профилирования.|Должно быть меньше максимального значения -1 (по умолчанию максимальное значение: 100 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. Сведения см. в разделе **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> |Microsoft ATA Center\Database &#42; Block Size|Количество сетевых операций особого вида, ожидающих записи в базу данных.|Должно быть меньше максимального значения -1 (по умолчанию максимальное значение: 50 000)|Проверьте, есть ли компоненты, которые достигли своего максимального размера и блокируют предыдущий компонент вплоть до прослушивателя сети. Сведения см. в разделе **Работа компонентов АТА** выше.<br /><br />Убедитесь, что нет проблем с центральным процессором и памятью.|
> 
> 
> [!NOTE]
> -   Единица измерения счетчиков — миллисекунды.
> -   Иногда удобнее отслеживать весь перечень счетчиков с помощью диаграммы "Отчет" (пример: наблюдение в реальном времени за всеми счетчиками).

## <a name="operating-system-counters"></a>Счетчики операционной системы
В следующей таблице приведен перечень основных счетчиков операционной системы, на которые следует обратить внимание:

> [!div class="mx-tableFixed"]
> 
> |Счетчик|Описание|Threshold|Диагностика|
> |-----------|---------------|-------------|-------------------|
> |Процессор(_Всего)\% загруженности процессора|Процент прошедшего времени, которое процессор тратит на выполнение непростаивающего потока.|В среднем менее 80%|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Процессор(_Всего)\% загруженности процессора" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "Система\Длина очереди процессора".|
> |System\Context Switches\sec|Частота, с которой все процессоры переключаются с одного потока на другой.|Менее чем 5000&#42;ядер (физических ядер)|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Процессор(_Всего)\% загруженности процессора" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "Система\Длина очереди процессора".|
> |Система\Длина очереди процессора|Количество потоков, готовых к выполнению и ожидающих назначения.|Менее пяти ядер (физических)|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше времени, чем должно быть.<br /><br />Добавьте процессоры.<br /><br />Сократите количество трафика на сервере.<br /><br />Счетчик "Процессор(_Всего)\% загруженности процессора" может быть менее точным на виртуальных серверах. В таком случае более точно определить нехватку мощности процессора можно с помощью счетчика "Система\Длина очереди процессора".|
> |\Память\Доступно МБ|Объем физической памяти (ОЗУ), доступной для выделения.|Должно быть более 512|Проверьте, есть ли специфические процессы, на выполнение которых затрачивается больше физической памяти, чем должно быть.<br /><br />Увеличьте объем физической памяти.<br /><br />Сократите количество трафика на сервере.|
> |LogicalDisk(&#42;)\Avg. Disk sec\Read|Средняя задержка чтения данных с диска (к примеру, вы должны выбрать диск с данными)|Должно занимать не более 10 миллисекунд|Проверьте, есть ли специфические процессы, которые занимают на диске с данными больше места, чем следует.<br /><br />Обратитесь к группе разработчиков хранилища или поставщику, чтобы узнать, может ли этот диск выполнять текущий объем рабочей нагрузки при задержке менее 10 мс. Текущий объем работы может быть определен с помощью счетчиков использования производительности.|
> |LogicalDisk(&#42;)\Avg. Disk sec\Write|Средняя задержка записи данных на диск (к примеру, вы должны выбрать диск с данными).|Должно занимать не более 10 миллисекунд|Проверьте, есть ли специфические процессы, которые занимают на диске с данными больше места, чем следует.<br /><br />Обратитесь к группе разработчиков хранилища или поставщику, чтобы узнать, может ли этот диск выполнять текущий объем рабочей нагрузки при задержке менее 10 мс. Текущий объем работы может быть определен с помощью счетчиков использования производительности.|
> |\LogicalDisk(&#42;)\Disk Reads\sec|Уровень выполнения операций чтения на диске.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|
> |\LogicalDisk(&#42;)\Disk Read Bytes\sec|Количество байт, считанных с диска за секунду.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|
> |\LogicalDisk&#42;\Disk Writes\sec|Уровень выполнения операций записи на диск.|Нет порогового значения|Счетчики использования производительности (могут помочь при устранении неполадок с памятью).|
> |\LogicalDisk(&#42;)\Disk Write Bytes\sec|Количество байт, записанных на диск за секунду.|Нет порогового значения|Счетчики использования производительности могут помочь при устранении неполадок с памятью.|

## <a name="see-also"></a>См. также
- [Предварительные требования ATA](ata-prerequisites.md)
- [Планирование производительности ATA](ata-capacity-planning.md)
- [Настройка сбора данных о событиях](configure-event-collection.md)
- [Настройка пересылки событий Windows](configure-event-collection.md)
- [Ознакомьтесь с форумом ATA.](https://social.technet.microsoft.com/Forums/security/home?forum=mata)
