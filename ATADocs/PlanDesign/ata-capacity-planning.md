---
title: "Планирование развертывания Advanced Threat Analytics | Документация Майкрософт"
description: "В этой статье содержатся сведения, которые помогут запланировать развертывание и определить, сколько серверов ATA потребуется для поддержки сети"
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 3/5/2017
ms.topic: get-started-article
ms.service: advanced-threat-analytics
ms.prod: 
ms.assetid: 279d79f2-962c-4c6f-9702-29744a5d50e2
ms.reviewer: bennyl
ms.suite: ems
ms.openlocfilehash: ce017adf26e30a5fde3c89a30c33f87d71716a4c
ms.sourcegitcommit: 998e8aed5835b228e907aab78845723a02521741
translationtype: HT
---
*Область применения: Advanced Threat Analytics версии 1.7*



# <a name="ata-capacity-planning"></a>Планирование производительности ATA
В этой статье содержится информация, которая поможет определить, сколько серверов ATA потребуется для мониторинга сети, а также понять, сколько шлюзов ATA и легковесных шлюзов ATA и какой уровень производительности серверов понадобится для Центра ATA и шлюзов ATA.

> [!NOTE] 
> Центр ATA можно развернуть в любом поставщике IaaS, если выполнены требования к производительности, описанные в этой статье.

##<a name="using-the-sizing-tool"></a>Использование средства изменения размера
Рекомендуемый и самый простой способ определить емкость развертывания ATA — это использовать [средство изменения размера ATA](http://aka.ms/atasizingtool). Запустите средство изменения размера ATA и в файле Excel с результатами определите необходимую емкость с помощью следующих полей:

- ЦП и память Центров ATA: сопоставьте поле **Busy Packets/sec** (Занятых пакетов/с) в таблице Центров ATA в файле результатов с полем **PACKETS PER SECOND** (ПАКЕТОВ В СЕКУНДУ) в [таблице Центров ATA](#ata-center-sizing).

- Хранилище Центров ATA: сопоставьте поле **Avg Packets/sec** (Среднее число пакетов/с) в таблице Центра ATA в файле результатов с полем **PACKETS PER SECOND** (ПАКЕТОВ В СЕКУНДУ) в [таблице Центров ATA](#ata-center-sizing).
- Шлюз ATA: сопоставьте поле **Busy Packets/sec** (Занятых пакетов/с) в таблице шлюзов ATA в файле результатов с полем **PACKETS PER SECOND** (ПАКЕТОВ В СЕКУНДУ) в [таблице шлюзов ATA](#ata-gateway-sizing) или [таблице легковесных шлюзов ATA](#ata-lightweight-gateway-sizing), в зависимости от [выбранного типа шлюза](#choosing-the-right-gateway-type-for-your-deployment).


![Пример средства планирования емкости](media/capacity tool.png)



Если по каким-либо причинам вы не можете использовать средство изменения размера ATA, необходимо вручную собрать данные о числе пакетов в секунду с очень низким интервалом сбора (примерно 5 секунд) со всех контроллеров домена за 24 часа. Затем для каждого контроллера домена необходимо вычислить ежедневное среднее значение и среднее значение самого занятого периода (15 минут).
В следующих разделах представлены инструкции по сбору числа пакетов в секунду с одного контроллера домена.



### <a name="ata-center-sizing"></a>Определение размера и количества ресурсов для центра ATA
Чтобы проанализировать поведение пользователя, центру ATA требуются данные минимум за 30 дней.
 

|Пакетов в секунду от всех контроллеров домена|ЦП (ядра*)|Память (ГБ)|Объем хранилища базы данных в день (ГБ)|Объем хранилища базы данных в месяц (ГБ)|Операций ввода-вывода**|
|---------------------------|-------------------------|-------------------|---------------------------------|-----------------------------------|-----------------------------------|
|1000|2|32|0,3|9|30 (100)
|10 000|4|48|3|90|200 (300)
|40 000|8|64|12|360|500 (1000)
|100 000|12|96|30|900|1000 (1500)
|400 000|40|128|120|3600|4000 (5000)

* Сюда относятся физические ядра, а не ядра с поддержкой технологии Hyper-Threading.

** Средние значения (пиковые значения).
> [!NOTE]
> -   Совокупное максимальное количество обрабатываемых центром ATA кадров в секунду из всех отслеживаемых контроллеров домена составляет 400 000. В некоторых средах один центр ATA может обрабатывать трафик, превышающий 400 000. Обратитесь к askcesec@microsoft.com. Вам помогут приступить к работе с такими средами.
> -   Указанные в таблице объемы памяти — это фактические значения. Всегда учитывайте будущий рост нагрузки и помните, что на диске базы данных должно быть по крайней мере 20 % свободного пространства.
> -   Если на диске базы данных остается менее 20 % (100 ГБ) свободного пространства, самая старая коллекция данных будет удалена. Это будет происходить, пока на диске останется только 5 % или 50 ГБ свободного пространства. Затем сбор данных будет остановлен.
> - Вы можете развернуть Центр ATA в любом поставщике IaaS, если выполнены требования к производительности, описанные в этой статье.
> -   При выполнении действий чтения и записи задержка хранилища должна быть менее 10 мс.
> -   Соотношение между количеством операций чтения и записи должно составлять примерно 1:3 при обработке меньше 100 000 пакетов в секунду и 1:6 при обработке свыше 100 000 пакетов в секунду.
> -   При запуске в качестве динамической памяти виртуальной машины или любой другой памяти функция воздушного шага не поддерживается.
> -   Для обеспечения оптимальной производительности задайте для **параметра электропитания** центра ATA значение **высокой производительности**.<br>
> -   При работе с физическим сервером для базы данных ATA необходимо **отключить** доступ к неоднородной памяти (NUMA) в BIOS. Система может ссылаться на NUMA как на чередование узла. В таком случае необходимо будет **включить** чередование узла, чтобы отключить NUMA. Дополнительные сведения см. в документации по BIOS. Обратите внимание на то, что это не имеет значение, если на виртуальном сервере запущен центр ATA.


## <a name="choosing-the-right-gateway-type-for-your-deployment"></a>Выбор правильного типа шлюза для развертывания
В развертывании ATA поддерживается любое сочетание типов шлюза ATA:

- Только шлюзы ATA
- Только упрощенные шлюзы ATA
- Комбинация шлюзов

При выборе типа развертывания шлюза необходимо учитывать следующее:

|Тип шлюза|Преимущества|Стоимость|Топология развертывания|Использование контроллера домена|
|----|----|----|----|-----|
|Шлюз ATA|Внешнее развертывание усложняет обнаружение ATA для злоумышленников|Выше|Устанавливается вместе с контроллером домена (внешняя установка)|Поддерживает до 50 000 пакетов в секунду|
|Упрощенный шлюз ATA|Не требует выделенного сервера и настройки зеркального отражения портов|Нижний|Устанавливается на контроллере домена|Поддерживает до 10 000 пакетов в секунду|

Ниже приведены примеры сценариев, в которых работу всех контроллеров домена контролирует упрощенный шлюз ATA:


- сайты филиалов;

- Виртуальные контроллеры доменов, развернутые в облаке (IaaS)


Ниже приведены примеры сценариев, в которых работу всех контроллеров домена контролирует шлюз ATA:


- Главные центры обработки данных (имеющие контроллеры доменов со скоростью передачи более 10 000 пакетов в секунду)


### <a name="ata-lightweight-gateway-sizing"></a>Размеры упрощенных шлюзов ATA

Упрощенный шлюз ATA поддерживает отслеживание одного контроллера домена в зависимости от объема сетевого трафика, создаваемого контроллером домена. 


|Пакетов в секунду&#42;|Число ядер ЦП&#42;&#42;|Память (ГБ)&#42;&#42;&#42;|
|---------------------------|-------------------------|---------------|
|1000|2|6|
|5000|6|16|
    |10 000|10|24|

&#42; Общее количество пакетов в секунду в контроллере домена, который отслеживает конкретный упрощенный шлюз ATA.

&#42;&#42; Общее количество ядер без применения технологии Hyper-Threading, установленные в этом контроллере домена.<br>Хотя технология Hyper-Threading является приемлемой для упрощенного шлюза ATA, при планировании производительности необходимо подсчитать фактические ядра и ядра без применения технологии Hyper-Threading.

&#42;&#42;&#42;Общий объем памяти, установленной в этом контроллере домена.

> [!NOTE]    
> -   Если в контроллере домена недостаточно ресурсов, необходимых для упрощенного шлюза ATA, это не повлияет на производительность контроллера домена, но упрощенный шлюз ATA, возможно, не будет работать должным образом.
> -   При запуске в качестве динамической памяти виртуальной машины или любой другой памяти функция воздушного шага не поддерживается.
> -   Для обеспечения оптимальной производительности задайте для **параметра электропитания** упрощенного шлюза ATA значение **высокой производительности**.
> -   Требуется не менее 5 ГБ пространства; рекомендуется 10 ГБ. Сюда входит пространство, необходимое для двоичных файлов ATA, [журналов ATA](/advanced-threat-analytics/troubleshoot/troubleshooting-ata-using-logs) и [журналов производительности](/advanced-threat-analytics/troubleshoot/troubleshooting-ata-using-perf-counters).


### <a name="ata-gateway-sizing"></a>Определение размера шлюза ATA

При определении числа шлюзов ATA, которые необходимо развернуть, учитывайте следующее.

-    **Леса и домены Active Directory**<br>
    ATA может отслеживать трафик из нескольких доменов в рамках одного леса Active Directory. Чтобы выполнять мониторинг нескольких лесов Active Directory, требуются отдельные развертывания ATA. Не следует настраивать одно развертывание ATA для отслеживания сетевого трафика контроллеров домена в разных лесах.

-    **Зеркальное отображение портов**<br>
Согласно рекомендациям по зеркальному отображению портов, возможно, потребуется развернуть несколько шлюзов ATA в центре данных или на сайте филиала.

-    **Емкость**<br>
    Шлюз ATA поддерживает отслеживание нескольких контроллеров домена в зависимости от объема сетевого трафика отслеживаемых контроллеров домена. 
<br>



|Пакетов в секунду&#42;|Число ядер ЦП&#42;&#42;|Память (ГБ)|
|---------------------------|-------------------------|---------------|
|1000|1|6|
|5000|2|10|
|10 000|3|12|
|20 000|6|24|
|50 000|16|48|
&#42; Среднее количество пакетов в секунду, отправляемых всеми контроллерами домена, которые отслеживает конкретный шлюз ATA в час наибольшей нагрузки.

&#42; Общий объем зеркально отображенного трафика контроллера домена не может превышать емкость сетевого адаптера в шлюзе ATA.

&#42;&#42; Технология Hyper-Threading должна быть отключена.

> [!NOTE] 
> -   Динамическая память не поддерживается.
> -   Для обеспечения оптимальной производительности установите **Параметр электропитания** шлюза ATA на **Высокую производительность**.
> -   Требуется не менее 5 ГБ пространства; рекомендуется 10 ГБ. Сюда входит пространство, необходимое для двоичных файлов ATA, [журналов ATA](/advanced-threat-analytics/troubleshoot/troubleshooting-ata-using-logs) и [журналов производительности](/advanced-threat-analytics/troubleshoot/troubleshooting-ata-using-perf-counters).


## <a name="domain-controller-traffic-estimation"></a>Оценка трафика контроллера домена
Существуют различные инструменты, с помощью которых можно определить среднее число пакетов в секунду, отправляемых с контроллеров домена. Если у вас нет таких инструментов, эти сведения можно отследить с помощью системного монитора.

Чтобы определить число пакетов в секунду, сделайте для каждого контроллера домена следующее:

1.  Откройте системный монитор.

    ![Изображение системного монитора](media/ATA-traffic-estimation-1.png)

2.  Разверните узел **Группы сборщиков данных**.

    ![Изображение узла "Группы сборщиков данных"](media/ATA-traffic-estimation-2.png)

3.  Щелкните правой кнопкой мыши узел **Определяется пользователем** и последовательно выберите **Создать** &gt; **Группа сборщиков данных**.

    ![Изображение окна создания группы сборщиков данных](media/ATA-traffic-estimation-3.png)

4.  Введите имя группы сборщиков данных и установите переключатель **Создать вручную (для опытных)**.

5.  В разделе **Какой тип данных вы хотите использовать?** установите переключатель **Создать журналы данных и счетчик производительности**.

    ![Изображение окна выбора типа данных для новой группы сборщиков данных](media/ATA-traffic-estimation-5.png)

6.  В разделе **Данные каких счетчиков производительности следует записывать в журнал?** выберите команду **Добавить**.

7.  Разверните узел **Сетевой адаптер**, выберите пункт **Пакетов/с** и выберите подходящий экземпляр. Если вы не уверены, выберите значение **&lt;Все экземпляры&gt;** и нажмите кнопку **Добавить**, а затем — **ОК**.

    > [!NOTE]
    > Чтобы увидеть имя адаптера и сведения о конфигурации, введите в командной строке команду `ipconfig /all`.

    ![Изображение окна добавления счетчиков производительности](media/ATA-traffic-estimation-7.png)

8.  Установите для параметра **Интервал выборки** значение **1 секунда**.

9. Задайте папку для хранения данных.

10. В разделе **Создать группу сборщиков данных** установите переключатель **Запустить группу сборщиков данных сейчас** и нажмите кнопку **Готово**.

    После этого отобразится новая группа сборщиков данных с зеленым треугольником, который указывает на то, что она активна.

11. Через 24 часа остановите группу сборщиков данных, щелкнув ее правой кнопкой мыши и выбрав **Остановить**.

    ![Изображения остановки группы сборщиков данных](media/ATA-traffic-estimation-12.png)

12. В проводнике перейдите к папке, в которой сохранен BLG-файл, и дважды щелкните его, чтобы открыть в системном мониторе.

13. Выберите счетчик пакетов в секунду и запишите приведенные в нем среднее и максимальные значения.

    ![Изображения счетчика пакетов в секунду](media/ATA-traffic-estimation-14.png)

## <a name="see-also"></a>См. также
- [Предварительные требования ATA](ata-prerequisites.md)
- [Архитектура ATA](ata-architecture.md)
- [Ознакомьтесь с форумом ATA.](https://social.technet.microsoft.com/Forums/security/home?forum=mata)
