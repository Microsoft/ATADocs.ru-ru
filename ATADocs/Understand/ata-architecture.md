---
# required metadata

title: Архитектура ATA | Microsoft Advanced Threat Analytics
description: Здесь описывается архитектура решения Microsoft Advance Threat Analytics
keywords:
author: rkarlin
manager: stevenpo
ms.date: 04/28/2016
ms.topic: article
ms.prod: identity-ata
ms.service: advanced-threat-analytics
ms.technology: security
ms.assetid: 892b16d2-58a6-49f9-8693-1e5f69d8299c

# optional metadata

#ROBOTS:
#audience:
#ms.devlang:
ms.reviewer: bennyl
ms.suite: ems
#ms.tgt_pltfrm:
#ms.custom:

---

# Архитектура ATA
Архитектура решения Microsoft Advanced Threat Analytics (ATA) подробно представлена на следующей схеме:

![Схема топологии архитектуры ATA](media/ATA-architecture-topology.jpg)

Решение ATA состоит из двух основных компонентов — шлюза и центра ATA.

Они выполняют зеркальное отображение входящего и исходящего сетевого трафика контроллеров домена, отслеживают события Windows (пересылаемые непосредственно из контроллеров домена или сервера SIEM) и анализируют данные для обнаружения атак и угроз.

В этом разделе рассматривается процесс фиксации сетевого трафика и событий, а также подробно описаны основные компоненты шлюза и центра ATA и их функции.

![Схема процесса фиксации трафика ATA](media/ATA-traffic-flow.jpg)

## Компоненты ATA
Решение ATA включает в себя следующие компоненты:

-   один или несколько шлюзов ATA;

-   центр АТА.

## Шлюз ATA
**Шлюз ATA** выполняет следующие функции:

-   фиксация и проверка сетевого трафика контроллеров домена путем зеркального отображения портов;

-   получение событий Windows из серверов SIEM или серверов системного журнала, либо из контроллеров домена с помощью функции пересылки событий Windows;

-   получение данных о пользователях и компьютерах из домена Active Directory;

-   разрешение сетевых сущностей (пользователей, групп и компьютеров);

-   передача соответствующих данных в центр ATA;

-   отслеживание нескольких контроллеров домена из одного шлюза ATA.

Шлюз ATA получает зеркально отображенный сетевой трафик и события Windows из сети и обрабатывает их с помощью следующих основных компонентов:

|||
|-|-|
|Прослушиватель сети|Этот компонент фиксирует и анализирует сетевой трафик. Эта задача существенно нагружает ЦП, поэтому при настройке шлюза ATA необходимо выполнить [предварительные требования для ATA](/advanced-threat-analytics/PlanDesign/ata-prerequisites).|
|Прослушиватель событий|Этот компонент фиксирует и анализирует события Windows, пересылаемые из сервера SIEM в сети.|
|Средство чтения журнала событий Windows|Этот компонент считывает и анализирует события Windows, пересылаемые в журнал событий Windows шлюза ATA из контроллеров домена.|
|Транслятор сетевых операций | Этот компонент преобразует проанализированный трафик (сетевые операции) в логическое представление ATA.
|Сопоставитель сущностей|Этот компонент принимает проанализированные данные (сетевой трафик и события) и разрешает их с помощью Active Directory, чтобы сопоставить сведения об учетных записях и удостоверениях с IP-адресами в этих данных.  Кроме того, сопоставитель сущностей проверяет заголовки пакетов и анализирует пакеты проверки подлинности для определения имен, свойств и удостоверений компьютеров, которые затем объединяются с данными в пакете.|
|Отправитель сущностей|Этот компонент отправляет проанализированные и сопоставленные данные в центр ATA.|
При определении числа шлюзов ATA, которые необходимо развернуть в сети, учитывайте следующее:

-   Леса и домены Active Directory.

    Шлюзы ATA могут отслеживать трафик из нескольких доменов в рамках одного леса Active Directory.   Чтобы выполнять мониторинг нескольких лесов Active Directory, требуются отдельные экземпляры ATA. Не следует настраивать шлюзы ATA для мониторинга сетевого трафика из контроллеров домена в разных лесах.

-   Зеркалирование портов

    Согласно рекомендациям по зеркальному отображению портов, вероятно, потребуется развернуть по крайней мере один шлюз ATA в центре обработки данных или географического региона.

-   Емкость

    Каждый шлюз ATA может анализировать и отправлять определенный объем трафика в секунду. Если отслеживаемые контроллеры домена отправляют и получают больше трафика, чем может обработать шлюз ATA, понадобится добавить дополнительные шлюзы ATA в соответствии с объемами трафика. Дополнительные сведения см. в статье [Планирование производительности ATA](/advanced-threat-analytics/PlanDesign/ata-capacity-planning).

## Центр АТА
**Центр ATA** выполняет следующие функции:

-   управление параметрами конфигурации шлюза ATA;

-   получение данных из шлюзов ATA;

-   выявление подозрительных действий;

-   выполнение различных механизмов машинного обучения для анализа поведения;

-   обеспечение работы консоли ATA;

-   отправка уведомлений о подозрительных действиях по электронной почте (настраивается отдельно).

Центр ATA получает проанализированный трафик из шлюза ATA, после чего выполняется профилирование, детерминированное обнаружение и запуск алгоритмов машинного обучения и анализа поведения. Это позволяет выявить аномалии и сообщить о подозрительных действиях.

|||
|-|-|
|Получатель сущностей|Этот компонент получает пакеты сущностей из всех шлюзов ATA.|
|Обработчик сетевых операций|Этот компонент обрабатывает все сетевые операции в каждом полученном пакете. К примеру, он сопоставляет различные действия Kerberos, выполненные на разных компьютерах.|
|Профилировщик сущностей|Этот компонент профилирует все уникальные сущности в соответствии с трафиком и событиями. Именно с помощью этого компонента ATA обновляет список компьютеров, с которых выполнен вход, для каждого профиля пользователя.|
|Клиент базы данных центра ATA |Этот компонент управляет процессом записи сетевых операций и событий в базу данных. |
|База данных|ATA использует базу данных MongoDB для хранения в системе следующих данных:<br /><br />— сетевых операций;<br />— событий;<br />— уникальных сущностей;<br />— подозрительных действий;<br />— данных конфигурации ATA.|
|Модули обнаружения|Эти компоненты выявляют подозрительные действия и аномальное поведение пользователей в сети, используя алгоритмы машинного обучения и детерминированные правила.|
|Консоль ATA|Этот компонент используется для настройки решения ATA и отслеживания подозрительных сетевых действий, обнаруженных этим решением. Консоль ATA не зависит от службы центра ATA и будет работать даже после ее остановки, если связь с базой данных не потеряна.|
При определении числа центров ATA, которые необходимо развернуть в сети, учитывайте следующее:

-   Один центр ATA может отслеживать лишь один лес Active Directory. При наличии нескольких лесов Active Directory для каждого из них требуется по крайней мере один центр ATA.

    При крупных развертываниях Active Directory одного центра ATA может быть недостаточно для обработки всего трафика из контроллеров домена. В этом случае потребуется несколько центров ATA, а эффективность обнаружения подозрительных действий уменьшится. Число центров ATA зависит от [запланированной производительности решения](/advanced-threat-analytics/PlanDesign/ata-capacity-planning).

## Компоненты сети
Чтобы использовать решение ATA в своей среде, необходимо внести небольшие изменения в сеть и выполнить требования, указанные ниже.

### Зеркальное отображение портов
При использовании ATA необходимо активировать зеркальное отображение всех контроллеров домена в отслеживаемом лесу Active Directory. Решение ATA будет работать, если зеркальное отображение портов включено только для некоторых контроллеров домена, однако эффективность обнаружения будет ниже.

Необходимо настроить зеркальное отображение портов контроллеров домена в шлюз ATA. Хотя при этом шлюз ATA получает весь зеркально отображенный сетевой трафик контроллера домена, для анализа в центр ATA отправляется лишь небольшой объем данных о трафике в сжатом виде.

Контроллеры домена и шлюзы ATA могут быть как физическими, так и виртуальными. Дополнительные сведения см. в разделе [Настройка зеркального отображения портов](/advanced-threat-analytics/PlanDesign/configure-port-mirroring).

### События
Для повышения эффективности обнаружения атак Pass-the-Hash решению ATA требуется доступ к событию 4776 из журнала событий Windows. Обеспечить передачу сведений об этом событии на шлюз ATA можно двумя способами — путем настройки прослушивания событий SIEM в шлюзе ATA или пересылки событий Windows.

-   Настройка прослушивания событий SIEM в шлюзе ATA

    Настройте пересылку определенных событий Windows из системы SIEM в ATA. ATA поддерживает несколько поставщиков SIEM. Дополнительные сведения см. в разделе [Настройка сбора данных о событиях](/advanced-threat-analytics/PlanDesign/configure-event-collection).

-   Настройка пересылки событий Windows

    Чтобы обеспечить отправку сведений о событиях в ATA, можно также настроить пересылку сведений о событиях Windows 4776 из контроллеров домена на шлюз ATA. Это целесообразно, если у вас нет SIEM или ваша версия SIEM в настоящее время не поддерживается в ATA. Дополнительные сведения о пересылке событий Windows в ATA см. в разделе [Настройка пересылки событий Windows](/advanced-threat-analytics/PlanDesign/configure-event-collection#ATA_event_WEF).

## См. также
- [Предварительные требования для ATA](/advanced-threat-analytics/PlanDesign/ata-prerequisites)
- [Планирование производительности ATA](/advanced-threat-analytics/PlanDesign/ata-capacity-planning)
- [Настройка сбора данных о событиях](/advanced-threat-analytics/PlanDesign/configure-event-collection)
- [Настройка пересылки событий Windows](/advanced-threat-analytics/PlanDesign/configure-event-collection#ATA_event_WEF)
- [Для получения поддержки посетите наш форум.](https://social.technet.microsoft.com/Forums/security/en-US/home?forum=mata)


<!--HONumber=Apr16_HO2-->


