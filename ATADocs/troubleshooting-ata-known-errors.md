---
title: Устранение известных неполадок ATA | Документы Майкрософт
description: Описывается устранение известных ошибок в ATA.
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 01/12/2021
ms.topic: conceptual
ms.prod: advanced-threat-analytics
ms.technology: ''
ms.assetid: d89e7aff-a6ef-48a3-ae87-6ac2e39f3bdb
ms.reviewer: arzinger
ms.suite: ems
ms.openlocfilehash: b49e2b10713f23c4256a7236bfa7162189c6e43b
ms.sourcegitcommit: 373151a0e86e4933c5cb7c8f17c4d386356c98dd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98114975"
---
# <a name="troubleshooting-ata-known-issues"></a>Устранение известных неполадок ATA

[!INCLUDE [Banner for top of topics](includes/banner.md)]

В этом разделе подробно описываются возможные ошибки в развертываниях ATA и действия, необходимые для их устранения.

## <a name="ata-gateway-and-lightweight-gateway-errors"></a>Ошибки шлюза ATA и упрощенного шлюза ATA

> [!div class="mx-tableFixed"]
>
> |Ошибка|Описание|Решение|
> |-------------|----------|---------|
> |System.DirectoryServices.Protocols.LdapException: произошла локальная ошибка|Шлюзу ATA не удалось выполнить аутентификацию в контроллере домена.|1. Убедитесь, что запись DNS контроллера домена правильно настроена на DNS-сервере. <br>2. Убедитесь, что время шлюза ATA синхронизировано с временем контроллера домена.|
> |System.IdentityModel.Tokens.SecurityTokenValidationException: не удалось проверить цепочку сертификатов|Шлюзу ATA не удалось проверить сертификат центра ATA.|1. Убедитесь, что сертификат корневого ЦС установлен в хранилище сертификатов доверенного центра сертификации на шлюзе ATA.<br>2. Убедитесь, что список отзыва сертификатов (CRL) доступен и что можно выполнить проверку отзыва сертификата.|
> |Microsoft.Common.ExtendedException: не удалось проанализировать время создания|Шлюзу ATA не удалось проанализировать сообщения системного журнала, пересланные с SIEM.|Убедитесь, что SIEM настроен для пересылки сообщений в одном из форматов, поддерживаемых ATA.|
> |System.ServiceModel.FaultException: ошибка при проверке безопасности сообщения.|Шлюзу ATA не удалось выполнить аутентификацию в центре ATA.|Убедитесь, что время шлюза ATA синхронизировано с временем центра ATA.|
> |System.ServiceModel.EndpointNotFoundException: не удалось подключиться к net.tcp://center.ip.addr:443/IEntityReceiver|Шлюзу ATA не удалось установить подключение к центру ATA.|Убедитесь, что параметры сети правильные, а сетевое подключение между шлюзом ATA и центром ATA активно.|
> |System.DirectoryServices.Protocols.LdapException: LDAP-сервер недоступен.|Шлюзу ATA не удалось выполнить запрос к контроллеру домена, используя протокол LDAP.|1. Убедитесь, что учетная запись пользователя, используемая ATA для подключения к домену Active Directory, имеет доступ на чтение для всех объектов в дереве Active Directory.<br>2. Убедитесь, что контроллер домена не защищен, чтобы предотвратить запросы LDAP от учетной записи пользователя, используемой ATA.|
> |Microsoft.Tri.Infrastructure.ContractException: исключение контракта|Шлюзу ATA не удалось синхронизировать конфигурацию из центра ATA.|Завершите настройку шлюза ATA в консоли ATA.|
> |System.Reflection.ReflectionTypeLoadException: не удалось загрузить один из запрошенных типов или несколько. Для получения дополнительных сведений извлеките свойство LoaderExceptions.|Анализатор сообщений устанавливается в шлюзе ATA.| Удалите анализатор сообщений.|
> |Ошибка [Layout] System.OutOfMemoryException: возникло исключение типа "System.OutOfMemoryException".|В шлюзе ATA недостаточно памяти.|Увеличьте объем памяти в контроллере домена.|
> |Не удалось запустить динамический потребитель ---> Microsoft.Opn.Runtime.Monitoring.MessageSessionException: поставщик события PEFNDIS не готов|PEF (анализатор сообщений) неправильно установлен.|Если вы используете Hyper-V, попробуйте обновить службы интеграции Hyper-V по-другому. Чтобы найти временное решение, обратитесь в службу поддержки.|
> |Сбой установки с ошибкой: 0x80070652|На компьютере есть другие незавершенные установки.|Дождитесь завершения других установок и при необходимости перезагрузите компьютер.|
> |System.InvalidOperationException: Instance 'Microsoft.Tri.Gateway' does not exist in the specified Category (System.InvalidOperationException: экземпляр "Microsoft.Tri.Gateway" не существует в указанной категории).|Идентификаторы процессов включены для имен процессов в шлюзе ATA.|См. раздел [Обработка повторяющихся имен экземпляров](/windows/win32/perfctrs/handling-duplicate-instance-names) для отключения PID в именах процессов.|
> System. InvalidOperationException: Категория не существует.|Счетчики, возможно, отключены в реестре.|Чтобы перестроить счетчики производительности, ознакомьтесь со статьей [KB2554336](https://support.microsoft.com/kb/2554336).|
> |System.ApplicationException: Unable to start ETW session MMA-ETW-Livecapture-a4f595bd-f567-49a7-b963-20fa4e370329 (System.ApplicationException: не удается запустить сеанс ETW MMA-ETW-Livecapture-a4f595bd-f567-49a7-b963-20fa4e370329)|Файл HOSTS, указывающий на имя компьютера, содержит запись узла.|Удалите запись узла из файла C:\Windows\System32\drivers\etc\HOSTS или сделайте ее полным доменным именем.|
> |System. IO. IOException: не удалось выполнить проверку подлинности, так как удаленная сторона закрыла транспортный поток или не смог создать защищенный канал SSL/TLS.|Протокол TLS 1.0 отключен в шлюзе ATA, но для .NET настроено использование TLS 1.2|Включите TLS 1,2 для .NET, установив для разделов реестра параметры по умолчанию для SSL и TLS, как описано ниже.<br></br>`[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319] "SystemDefaultTlsVersions"=dword:00000001`</br> `[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319] "SystemDefaultTlsVersions"=dword:00000001`</br>`[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319] "SchUseStrongCrypto"=dword:00000001` </br>`[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319] " SchUseStrongCrypto"=dword:00000001`|
> |System.TypeLoadException: не удалось загрузить тип "Microsoft.Opn.Runtime.Values.BinaryValueBufferManager" из сборки "Microsoft.Opn.Runtime, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"|Шлюзу ATA не удалось загрузить необходимые файлы анализа.|Проверьте, установлен ли анализатор сообщений Майкрософт. Установка анализатора сообщений вместе со шлюзом ATA или упрощенным шлюзом ATA не поддерживается. Удалите анализатор сообщений и перезапустите службу шлюза.|
> |System.Net.WebException: удаленный сервер вернул ошибку: требуется проверка подлинности прокси-сервера (407)|Связь шлюза ATA с центром ATA прерывается прокси-сервером.|Отключите прокси-сервер на компьютере со шлюзом ATA. <br></br>Обратите внимание, что параметры прокси-сервера могут применяться к отдельным учетным записям.|
> |System.IO.DirectoryNotFoundException: система не может найти указанный путь. (Исключение из HRESULT: 0x80070003)|Не запущена одна или несколько служб, необходимых для работы ATA.|Запустите следующие службы: <br></br>Журналы и оповещения производительности (PLA), планировщик задач (расписание).|
> |System.Net.WebException: удаленный сервер возвратил ошибку "403 —запрещено".|Шлюзу ATA или упрощенному шлюзу запрещено устанавливать HTTP-соединение, так как центр ATA не является доверенным.|Добавьте NetBIOS-имя и FQDN центра ATA в список доверенных веб-сайтов и очистите кэш в Internet Explorer (или в соответствии с именем центра ATA, как указано в конфигурации, если настроенный параметр отличается от NetBIOS/FQDN).|
> |System.Net.Http.HttpRequestException: сбой PostAsync [requestTypeName=StopNetEventSessionRequest]|Шлюзу ATA или упрощенному шлюзу ATA не удается остановить и запустить сеанс трассировки событий Windows, в котором собирается трафик, из-за проблемы с инструментарием WMI.|Чтобы устранить проблему с инструментарием WMI, выполните инструкции в статье [WMI: Rebuilding the WMI Repository](https://blogs.technet.microsoft.com/askperf/2009/04/13/wmi-rebuilding-the-wmi-repository/) (WMI: перестроение репозитория).|
> |System.Net.Sockets.SocketException: предпринята попытка получить доступ к сокету способом, запрещенным правами доступа|Другое приложение использует порт 514 на шлюзе ATA|Используйте `netstat -o`, чтобы определить, какой процесс использует этот порт.|

## <a name="deployment-errors"></a>Ошибки развертывания

> [!div class="mx-tableFixed"]
>
> |Ошибка|Описание|Решение|
> |-------------|----------|---------|
> |Происходит сбой установки .NET Framework 4.6.1 с ошибкой 0x800713ec|На сервере не установлены необходимые компоненты для платформы .NET Framework 4.6.1. |Перед установкой ATA убедитесь, что на сервере установлены обновления Windows [KB2919442](https://www.microsoft.com/download/details.aspx?id=42135) и [KB2919355](https://support.microsoft.com/kb/2919355).|
> |System.Threading.Tasks.TaskCanceledException: отменена задача|Истекло время ожидания процесса развертывания, так как ему не удалось связаться с центром ATA.|1. Проверьте сетевое подключение к центру ATA, перейдя по его IP-адресу. <br></br>2. Проверьте конфигурацию прокси-сервера или брандмауэра.|
> |System.Net.Http.HttpRequestException: An error occurred while sending the request. ---> System.Net.WebException: удаленный сервер возвратил ошибку: (407) Требуется проверка подлинности прокси.|Истекло время ожидания процесса развертывания, так как ему не удалось связаться с центром ATA из-за неправильной настройки прокси-сервера.|Отключите конфигурацию прокси-сервера перед развертыванием, а затем включите ее повторно. Вы также можете настроить исключение на прокси-сервере.|
> |System.Net.Sockets.SocketException: существующее подключение было принудительно закрыто удаленным узлом||Включите TLS 1,2 для .NET, установив для разделов реестра параметры по умолчанию для SSL и TLS, как описано ниже.<br></br>`[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319] "SystemDefaultTlsVersions"=dword:00000001`</br>`[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319] "SystemDefaultTlsVersions"=dword:00000001`</br>`[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319] "SchUseStrongCrypto"=dword:00000001` </br>`[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319] "SchUseStrongCrypto"=dword:00000001`|
> |Ошибка [ \\ [] DeploymentModel [ \\ ]] ошибка проверки подлинности управления [ \\ [] куррентлилогжедонусер = <domain> \\ <username> Status = фаиледаусентикатион Exception = [ \\ ]]|При развертывании шлюза ATA и упрощенного шлюза ATA не удалось выполнить аутентификацию в центре ATA.|Откройте браузер на компьютере, где произошел сбой развертывания, и попробуйте получить доступ к консоли ATA. </br>Если это нельзя сделать, запустите процесс устранения неполадок, чтобы узнать, почему браузер не может выполнить аутентификацию в центре ATA. </br>Проверьте следующее: </br>настройки прокси-сервера;</br>Проблемы с сетью</br>параметры групповой политики для аутентификации на этом компьютере, которые отличаются от параметров в центре ATA.|
> | Ошибка [\\[]DeploymentModel[\\]]. Сбой проверки подлинности управления.|Сбой проверки сертификата центра.|Для проверки сертификата центра может потребоваться подключение к Интернету. Убедитесь, что конфигурация прокси-сервера в службе шлюза позволяет обеспечить подключение и проверку.|
> | При развертывании центра и выборе сертификата отображается сообщение об ошибке "не поддерживается"|Это может произойти, если выбранный сертификат не соответствует требованиям, или закрытый ключ сертификата недоступен.|Убедитесь, что вы используете развертывание с повышенными привилегиями (**Запуск от имени администратора**) и выбранный сертификат соответствует [требованиям](ata-prerequisites.md#certificates).|

## <a name="ata-center-errors"></a>Ошибки центра ATA

> [!div class="mx-tableFixed"]
>
> |Ошибка|Описание|Решение|
> |-------------|----------|---------|
> |System.Security.Cryptography.CryptographicException: отказано в доступе.|Центру ATA не удалось использовать выданный сертификат для расшифровки. Скорее всего, это произошло из-за использования сертификата, в котором для KeySpec (KeyNumber) задано значение Signature (AT\\_SIGNATURE), что не поддерживается для расшифровки, вместо использования KeyExchange (AT\\_KEYEXCHANGE).|1. останавливает службу центра ATA. <br></br>2. Удалите сертификат центра ATA из хранилища сертификатов центра. (Перед удалением убедитесь, что у вас есть сертификат с копией закрытого ключа в PFX-файле.) <br></br>3. Откройте командную строку с повышенными привилегиями и выполните команду certutil-importpfx "Центерцертификате. pfx" по адресу \\ _KEYEXCHANGE <br></br>4. Запустите службу центра ATA. <br></br>5. Убедитесь, что все работает правильно.|

## <a name="ata-gateway-and-lightweight-gateway-issues"></a>Проблемы со шлюзом ATA и упрощенным шлюзом

> [!div class="mx-tableFixed"]
>
> |Проблема|Описание|Решение|
> |-------------|----------|---------|
> |Не получен трафик от контроллера домена, но наблюдаются оповещения о работоспособности|От контроллера домена не поступает трафик с использованием зеркального отображения портов через шлюз ATA|В сетевом адаптере захвата в шлюзе ATA отключите следующие функции в разделе **Дополнительные параметры**:<br></br>объединение полученных сегментов (IPv4);<br></br>объединение полученных сегментов (IPv6).|
> |Это предупреждение о работоспособности отображается: часть сетевого трафика не анализируется|Если у вас есть шлюз ATA или упрощенный шлюз на виртуальных машинах VMware, вы можете получить это оповещение о работоспособности. Это происходит из-за несоответствия конфигураций в VMware.|Задайте в конфигурации сетевого адаптера виртуальной машины значения 0 или Отключено для следующих параметров: TsoEnable, LargeSendOffload, TSO Offload, Giant TSO Offload|

## <a name="multi-processor-group-mode"></a>Многопроцессорный групповой режим

Для операционных систем Windows 2008R2 и 2012 шлюз ATA не поддерживается в **многопроцессорных групповых** режимах.

Возможные обходные пути:

- Если технология Hyper-Threading включена, отключите ее. Это может сократить количество логических ядер, чтобы избежать необходимости запуска в **многопроцессорном групповом** режиме.

- Если у виртуальной машины менее 64 логических ядер и она выполняется на узле HP, для параметра BIOS **NUMA Group Size Optimization** (Оптимизация размера группы NUMA) можно изменить значение по умолчанию **Clustered** (Кластеризовано) значением **Flat** (Фиксировано).

## <a name="see-also"></a>См. также:

- [Предварительные требования ATA](ata-prerequisites.md)
- [Планирование производительности ATA](ata-capacity-planning.md)
- [Настройка сбора данных о событиях](configure-event-collection.md)
- [Настройка пересылки событий Windows](configure-event-collection.md)
- [Обязательно ознакомьтесь с форумом ATA.](https://social.technet.microsoft.com/Forums/security/home?forum=mata)
