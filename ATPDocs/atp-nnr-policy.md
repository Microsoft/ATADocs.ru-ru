---
title: Разрешение сетевых имен в службе "Расширенная защита от угроз Azure" | Документация Майкрософт
description: В этой статье описана функция разрешения сетевых имен в Azure ATP и способы ее использования.
keywords: ''
author: mlottner
ms.author: mlottner
manager: rkarlin
ms.date: 10/22/2019
ms.topic: conceptual
ms.collection: M365-security-compliance
ms.service: azure-advanced-threat-protection
ms.assetid: 1ac873fc-b763-41d7-878e-7c08da421cb5
ms.reviewer: itargoet
ms.suite: ems
ms.openlocfilehash: cb9275c90afda7a5ec98cf238205232b2bcfb66f
ms.sourcegitcommit: 6dd002b5a34f230aaada55a6f6178c2f9e1584d9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2019
ms.locfileid: "72776608"
---
# <a name="what-is-network-name-resolution"></a>Разрешение сетевых имен

Разрешение сетевых имен (NNR) — главный компонент функций Azure ATP. В Azure ATP действия фиксируются на основе сетевого трафика, событий Windows и трассировки событий Windows. Все эти действия обычно содержат данные об IP-адресах. 

Благодаря механизму NNR Azure ATP может сопоставлять необработанные действия (содержащие IP-адреса) и соответствующие компьютеры, участвующие в каждом действии. На основе необработанных действий Azure ATP профилирует сущности, включая компьютеры, и создает оповещения системы безопасности о подозрительных действиях.

Чтобы разрешить IP-адреса для имен компьютеров, датчики Azure ATP запрашивают IP-адрес для имени соответствующего компьютера, используя один из следующих методов:

- NTLM через RPC (TCP-порт 135)
- NetBIOS (UDP-порт 137)
- RDP (TCP-порт 3389), только первый пакет **приветствия клиента**.
- Запросы к DNS-серверу с помощью обратного поиска IP-адреса в DNS (UDP 53).

> [!NOTE]
> Ни на одном порте не выполняется проверка подлинности.

Azure ATP оценивает и определяет операционную систему устройства на основе сетевого трафика. Получив имя компьютера, датчик Azure ATP проверяет в Active Directory наличие соответствующего объекта-компьютера с таким же именем с помощью отпечатков TCP. Использование отпечатков TCP помогает выявлять незарегистрированные устройства и устройства с ОС, отличной от Windows, содействуя вам в процессе анализа. Если датчик Azure ATP обнаруживает корреляцию, он связывает IP-адрес с этим объектом-компьютером. 

Если имя не получено, создается соответствующий **неразрешенный профиль компьютера** с таким IP-адресом и связанным обнаруженным действием.

![Неразрешенный профиль компьютера](media/unresolved-computer-profile.png)


Данные механизма разрешения сетевых имен крайне важны для обнаружения таких угроз:

- Предполагаемая кража удостоверения (Pass-the-Ticket)
- Предполагаемая атака DCSync (репликация служб каталогов)
- Рекогносцировка путем сетевого сопоставления (DNS)

Для улучшения возможности определить, является ли оповещение **истинно положительным (TP)** или **ложно положительным (FP)** , в Azure ATP предусмотрена степень достоверности для разрешения имен в качестве подтверждения каждого оповещения системы безопасности. 
 
Например, если имена компьютеров были разрешены с **высоким уровнем достоверности**, достоверность результирующего оповещения системы безопасности увеличивается до уровня **Истинно положительный** (**TP**). 

Свидетельство включает время, IP-адрес и имя компьютера, полученное после разрешения IP-адреса. Если уровень достоверности разрешения **низкий**, используйте эти сведения для определения того, какое устройство было фактическим источником IP-адреса на тот момент, и проверки таких данных. После подтверждения устройства вы можете определить, является ли оповещение **ложно положительным** (**FP**), как описано ниже:

- Предполагаемая кража идентификационных данных (Pass-the-Ticket) — оповещение активировано для одного компьютера.
- Предполагаемая атака DCSync (репликация служб каталогов) — оповещение активировано с контроллера домена.
- Рекогносцировка путем сетевого сопоставления (DNS) — оповещение активировано с DNS-сервера.

    ![Достоверность свидетельства](media/nnr-high-certainty.png)



### <a name="prerequisites"></a>Предварительные условия
|Протокол|  Транспорт|  Port|   Устройство| Direction|
|--------|--------|------|-------|------|
|HTML через RPC| TCP |135|   Все устройства в сети| Входящие|
|NetBIOS|   UDP|    137|    Все устройства в сети| Входящие|
|DNS|   UDP|    53| Контроллеры домена| Исходящее|
|

Если у устройств в среде открыт порт 3389, датчик Azure ATP использует его для разрешения сетевых имен.
Открытие порта 3389 **необязательно**. Это только дополнительный метод, который может предоставить имя компьютера, если порт уже открыт для других целей.

Чтобы убедиться в том, что Azure ATP работает как положено и среда настроена правильно, Azure ATP проверяет состояние разрешения всех датчиков и выдает оповещение мониторинга для каждого метода, предоставляя список датчиков Azure ATP с малой долей успешных попыток активного разрешения имен с использованием каждого метода.

> [!NOTE]
> Чтобы отключить дополнительный метод разрешения сетевых имен (NNR) в Azure ATP в соответствии с требованиями вашей среды, обратитесь в службу поддержки. 

Каждое оповещение мониторинга предоставляет подробные сведения о методе, датчиках, проблемной политике, а также рекомендации по настройке.

![Оповещение о малой доле успешных попыток разрешения сетевых имен](media/atp-nnr-success-rate.png)



### <a name="configuration-recommendations"></a>Рекомендации по настройке

- RPC через NTLM:
    - Убедитесь, что TCP-порт 135 открыт для входящей связи с датчиками Azure ATP на всех компьютерах в среде.
    - Проверьте все сетевые конфигурации (брандмауэры), так как они могут препятствовать обмену данными через соответствующие порты.

- NetBIOS:
    - Убедитесь, что UDP-порт 137 открыт для входящей связи с датчиками Azure ATP на всех компьютерах в среде.
    - Проверьте все сетевые конфигурации (брандмауэры), так как они могут препятствовать обмену данными через соответствующие порты.
- Обратный поиск в DNS:
    - Убедитесь, что датчик может устанавливать связь с DNS-сервером, а зоны обратного просмотра включены.


## <a name="see-also"></a>См. также
- [Предварительные требования к Azure ATP](atp-prerequisites.md)
- [Настройка сбора данных о событиях](configure-event-collection.md)
- [Обязательно ознакомьтесь с форумом ATP](https://aka.ms/azureatpcommunity)
