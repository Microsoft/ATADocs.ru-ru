---
title: Краткое руководство. Планирование развертывания Azure ATP | Документация Майкрософт
description: В этой статье содержатся сведения, которые помогут запланировать развертывание и определить, сколько серверов Azure ATP потребуется для поддержки сети.
author: mlottner
ms.author: mlottner
ms.date: 11/05/2019
ms.topic: quickstart
ms.collection: M365-security-compliance
ms.service: azure-advanced-threat-protection
ms.openlocfilehash: b07800cfc3b2df6fdb290fff27a9e807be15056f
ms.sourcegitcommit: 6dd002b5a34f230aaada55a6f6178c2f9e1584d9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2019
ms.locfileid: "74540888"
---
# <a name="quickstart-plan-capacity-for-azure-atp"></a>Краткое руководство. Планирование производительности для Azure ATP

В этом кратком руководстве содержатся сведения, которые помогут определить необходимое количество датчиков и автономных датчиков Azure ATP.

## <a name="prerequisites"></a>Предварительные условия

- Скачайте [средство изменения размера Azure ATP](https://aka.ms/aatpsizingtool).
- См. дополнительные сведения об [архитектуре Azure ATP](atp-architecture.md).
- См. дополнительные сведения о [предварительных условиях для Azure ATP](atp-prerequisites.md). 


## <a name="use-the-sizing-tool"></a>Использование средства изменения размера

Рекомендуемый и самый простой способ определить емкость развертывания Azure ATP — это использовать средство изменения размера Azure ATP. Если не удается использовать это средство, вы можете собрать информацию о трафике вручную. Дополнительные сведения о методе сбора информации вручную см. в разделе [Средство оценки трафика контроллера домена](#manual-sizing) этой статьи.

1. Запустите средство изменения размера Azure ATP **TriSizingTool.exe** из скачанного ZIP-файла. 
2. Когда средство завершит работу, откройте файл Excel с результатами.
3. В файле Excel найдите и щелкните лист **Azure ATP Summary** (Сводка Azure ATP). Другие листы не понадобятся, так как они используются при планировании ресурсов ATA.
   ![Пример средства планирования емкости](media/capacity-tool.png)

4. В файле Excel с результатами найдите поле **Busy Packets/sec** (Кол-во занятых пакетов/с) в таблице датчика Azure ATP и запишите его значение.
5. Выберите тип своего датчика. Воспользуйтесь информацией в разделе [Выбор правильного типа датчика](#choosing-the-right-sensor-type-for-your-deployment), чтобы определить требуемый тип датчика. Выбирая тип датчика, учитывайте значение поля **Busy Packets/sec** (Кол-во занятых пакетов/с).
6. Найдите **записанное количество пакетов** в поле **PACKETS PER SECOND** (Кол-во пакетов в секунду) в [таблице датчиков Azure ATP](#sizing) в этой статье. Воспользуйтесь информацией из этих полей, чтобы определить объем памяти и ресурсы ЦП, которые требуются для работы датчика.


## Выбор правильного типа датчика для развертывания<a name="choosing-the-right-sensor-type-for-your-deployment"></a>

В развертывании Azure ATP поддерживается любое сочетание типов датчиков Azure:

- Только датчики Azure ATP
- Только автономные датчики Azure ATP
- Комбинация шлюзов

При выборе типа развертывания датчика необходимо учитывать указанные ниже преимущества.

|Тип датчика|Преимущества|Стоимость|Топология развертывания|Использование контроллера домена|
|----|----|----|----|-----|
|Датчик Azure ATP|Не требует выделенного сервера и настройки зеркального отражения портов|Нижний|Устанавливается на контроллере домена|Поддерживает до 100 000 пакетов в секунду|
|Автономный датчик Azure ATP|Внешнее развертывание усложняет обнаружение Azure ATP для злоумышленников.|Выше|Устанавливается вместе с контроллером домена (внешняя установка)|Поддерживает до 100 000 пакетов в секунду|


При определении количества автономных датчиков Azure ATP, которое необходимо развернуть, учитывайте указанные ниже моменты:

- **Леса и домены Active Directory** — Azure ATP может отслеживать трафик из нескольких доменов в нескольких лесах Active Directory для каждого создаваемого экземпляра Azure ATP.

- **Зеркальное отображение портов** — согласно рекомендациям по зеркальному отображению портов, возможно, потребуется развернуть несколько автономных датчиков Azure ATP в центре данных или на сайте филиала.

- **Производительность** — автономный датчик Azure ATP поддерживает отслеживание нескольких контроллеров домена в зависимости от объема сетевого трафика отслеживаемых контроллеров домена.

## <a name="sizing"></a>Изменение размера датчика и автономного датчика Azure ATP 

Датчик Azure ATP позволяет отслеживать контроллер домена в зависимости от объема сетевого трафика, создаваемого этим контроллером. В следующей таблице приводятся приблизительные данные. Окончательный объем, анализируемый датчиком, зависит от объема и распределения трафика.

Следующие значения емкости для ЦП и памяти относятся к **потреблению самого датчика**, а не емкости контроллеров доменов.

|Пакетов в секунду*|ЦП (ядра)**|Память (ГБ)|
|----|----|-----|
|0–1 тыс.|0,25|2,50|
|1–5 тыс.|0,75|6,00|
|5–10 тыс.|1,00|6,50|
|10–20 тыс.|2,00|9,00|
|20–50 тыс.|3,50|9,50|
|50–75 тыс. |3,50|9,50|
|75–100 тыс.|3,50|9,50|
|

** К ним относятся физические ядра, а не ядра с поддержкой технологии Hyper-Threading. 

При определении размера, учитывайте следующие моменты: 

- Общее количество ядер, которые будет использовать служба датчика.<br>Рекомендуем не использовать ядра с поддержкой технологии Hyper-Threading. Работа с ядрами, поддерживающими технологию Hyper-Threading, может привести к проблемам с работоспособностью датчика Azure ATP. 
- Общий объем памяти, который будет использовать служба датчика.
- Если на контроллере домена нет ресурсов, необходимых для работы датчика Azure ATP, это не повлияет на производительность контроллера. При этом возможно, что датчик Azure ATP не будет работать должным образом.
- При запуске в качестве виртуальной машины всю память нужно выделить для виртуальной машины на постоянной основе.
- Для обеспечения оптимальной производительности задайте для **параметра электропитания** датчика Azure ATP значение **высокой производительности**.
- Для этой задачи необходимо не менее 2 ядер и 6 ГБ свободного пространства. Рекомендуем использовать 10 ГБ, включая пространство, необходимое для двоичных файлов и журналов Azure ATP.

### <a name="dynamic-memory"></a>Динамическая память

> [!NOTE] 
> При запуске в качестве виртуальной машины всю память нужно выделить для виртуальной машины на постоянной основе. 

|Платформа запуска виртуальной машины|Описание|
|------------|-------------|
|Hyper-V|Убедитесь, что для виртуальной машины отключена функция **Включить динамическую память**.|
|VMWare|Убедитесь, что настроенный объем памяти и объем зарезервированной памяти одинаковы, или выберите параметр **Reserve all guest memory (All locked)** (Зарезервировать всю память гостевой ОС (все заблокированные)) в настройках виртуальной машины.|
|Другой узел виртуализации|Сведения о том, как обеспечить полное выделение памяти для виртуальной машины на постоянной основе, см. в документации, предоставленной поставщиком. |
|

При запуске в качестве виртуальной машины следует завершить работу сервера перед созданием новой контрольной точки, чтобы избежать возможного повреждения базы данных.

## <a name="manual-sizing"></a>Оценка трафика контроллера домена

Если по каким-либо причинам вы не можете использовать средство изменения размера Azure ATP, необходимо вручную собрать данные о количестве пакетов в секунду со всех контроллеров домена. Рекомендуем собирать данные за 24 часа с коротким интервалом (примерно 5 секунд). Затем для каждого контроллера домена вычислите ежедневное среднее значение и среднее значение самого занятого периода (15 минут). В следующих разделах представлены инструкции по сбору числа пакетов в секунду с одного контроллера домена.

Существуют различные инструменты, с помощью которых можно определить среднее число пакетов в секунду, отправляемых с контроллеров домена. Если у вас нет таких инструментов, эти сведения можно отследить с помощью системного монитора.

Чтобы определить количество пакетов в секунду, выполните на каждом контроллере домена указанные ниже действия:

1.  Откройте системный монитор.

    ![Изображение системного монитора](media/atp-traffic-estimation-1.png)

2.  Разверните узел **Группы сборщиков данных**.

    ![Изображение узла "Группы сборщиков данных"](media/atp-traffic-estimation-2.png)

3.  Щелкните правой кнопкой мыши узел **Определяется пользователем** и последовательно выберите **Создать** &gt; **Группа сборщиков данных**.

    ![Изображение окна создания группы сборщиков данных](media/atp-traffic-estimation-3.png)

4.  Введите имя группы сборщиков данных и установите переключатель **Создать вручную (для опытных)** .

5.  В разделе **Какой тип данных вы хотите использовать?** выберите **Создать журналы данных и Счетчик производительности**.

    ![Изображение окна выбора типа данных для новой группы сборщиков данных](media/atp-traffic-estimation-5.png)

6.  В разделе **Какие счетчики производительности следует записывать в журнал?** нажмите кнопку **Добавить**.

7.  Разверните узел **Сетевой адаптер**, выберите пункт **Пакетов/с** и выберите подходящий экземпляр. Если вы не уверены, выберите значение **&lt;Все экземпляры&gt;** и нажмите кнопку **Добавить**, а затем — **ОК**.

    > [!NOTE]
    > Чтобы увидеть имя адаптера и сведения о конфигурации, выполните в командной строке команду `ipconfig /all`.

    ![Изображение окна добавления счетчиков производительности](media/atp-traffic-estimation-7.png)

8.  Установите для параметра **Интервал выборки** значение **5 секунд**.

9. Задайте папку для хранения данных.

10. В разделе **Create the data collector set** (Создать группу сборщиков данных) выберите **Запустить группу сборщиков данных сейчас** и нажмите кнопку **Готово**.

    После этого отобразится созданная группа сборщиков данных с зеленым треугольником, который указывает на то, что она активна.

11. Через 24 часа остановите группу сборщиков данных, щелкнув ее правой кнопкой мыши и выбрав пункт **Остановить**.

    ![Изображения остановки группы сборщиков данных](media/atp-traffic-estimation-12.png)

12. В проводнике перейдите к папке, в которой сохранен BLG-файл, и дважды щелкните его, чтобы открыть в системном мониторе.

13. Выберите счетчик пакетов в секунду и запишите приведенные в нем среднее и максимальные значения.

    ![Изображения счетчика пакетов в секунду](media/atp-traffic-estimation-14.png)



## <a name="next-steps"></a>Дальнейшие шаги

В этом кратком руководстве описано, как определить необходимое количество датчиков и автономных датчиков Azure ATP. Вы также можете определить размер датчиков. Перейдите к краткому руководству по созданию экземпляра Azure ATP.

> [!div class="nextstepaction"]
> [Создание экземпляра Azure ATP](install-atp-step1.md)


## <a name="join-the-community"></a>Присоединяйтесь к сообществу!

Возникли дополнительные вопросы или желание обсудить с другими пользователями службу Azure ATP и связанные с ней вопросы безопасности? Присоединяйтесь к [сообществу Azure ATP](https://aka.ms/azureatpcommunity)!
